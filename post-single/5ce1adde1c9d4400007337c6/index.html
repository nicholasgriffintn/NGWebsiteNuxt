<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="lang">
  <head data-n-head="">
    <title data-n-head="true">Adding Service Worker to my site | Nicholas Griffin</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="keywords" name="keywords" content="web developer,blogger,technology,founder,TechNutty"><meta data-n-head="true" data-hid="author" name="author" content="Nicholas Griffin"><meta data-n-head="true" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="true" data-hid="apple-mobile-web-app-title" name="apple-mobile-web-app-title" content="nicholasgriffin"><meta data-n-head="true" data-hid="theme-color" name="theme-color" content="#fff"><meta data-n-head="true" data-hid="og:type" name="og:type" property="og:type" content="website"><meta data-n-head="true" data-hid="og:title" name="og:title" property="og:title" content="nicholasgriffin"><meta data-n-head="true" data-hid="og:site_name" name="og:site_name" property="og:site_name" content="nicholasgriffin"><meta data-n-head="true" data-hid="og:description" name="og:description" property="og:description" content="My personal website"><meta data-n-head="true" data-hid="description" name="description" content="Whoops! I forgot to add Service Worker to my site. Probably about time to do that..."><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-57x57.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-60x60.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-72x72.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-76x76.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-114x114.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-120x120.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-144x144.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-180x180.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-32x32.png" sizes="32x32"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/android-chrome-192x192.png" sizes="192x192"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-96x96.png" sizes="96x96"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-16x16.png" sizes="16x16"><link data-n-head="true" rel="mask-icon" type="apple-touch-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5"><link data-n-head="true" name="apple-mobile-web-app-title" content="Nicholas Griffin"><link data-n-head="true" name="application-name" content="Nicholas Griffin"><link data-n-head="true" name="theme-color" content="#5bbad5"><link data-n-head="true" rel="manifest" href="/manifest.json"><link data-n-head="true" rel="shortcut icon" href="/_nuxt/icons/icon_64.8AAfD9L2mjc.png"><link data-n-head="true" rel="apple-touch-icon" href="/_nuxt/icons/icon_512.8AAfD9L2mjc.png" sizes="512x512"><link rel="preload" href="/_nuxt/335238b4871730cf9f7d.js" as="script"><link rel="preload" href="/_nuxt/d26db56abffc2e10e685.js" as="script"><link rel="preload" href="/_nuxt/ed5ca3c40fa941f82244.js" as="script"><link rel="preload" href="/_nuxt/8c50d3902d6da8d5999e.js" as="script"><link rel="preload" href="/_nuxt/ad3882a62a81c04ccdbd.js" as="script"><style data-vue-ssr-id="17cfdfa9:0 aab9a468:0 9a8fa946:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#fff;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}body,div#root{overflow-x:hidden}body,html{margin:0;padding:0;border:0;outline:0;vertical-align:baseline;background:0 0}.single-page .mid-box-background{padding-top:2rem;padding-bottom:2rem}.App{text-align:center}.App-header{position:fixed;top:0;left:0;width:100%;height:70vh;background-color:#222;padding:20vh 20px 20px;padding-left:0!important;color:#fff}.background-colours{opacity:.1}.background{position:absolute;top:0;right:0;bottom:0;left:0;background:#093054;background:-webkit-gradient(left top,right bottom,color-stop(0,#093054),color-stop(100%,#0b1042));background:linear-gradient(135deg,#093054,#0b1042)}.title-wrapper h1{font-size:3.1em!important;line-height:1.4;font-weight:700;color:#fff}.App-content{min-height:100vh;width:100vw;position:relative;background:#fff;z-index:9}.lazy{opacity:1;transition:opacity .3s}.lazy[data-src]{opacity:0}#OpeningContentWrapper img{max-height:80px;height:120px;margin-bottom:20px;margin-top:20px;width:auto}#BlogPostOpenerWrapper{display:inline-block;padding-top:40px;padding-bottom:40px;margin-top:20px;width:100%;color:#fff}#OpeningContentSocial a{text-decoration:none}#default-typed-strings,#second-typed-strings-delay,#third-typed-strings-delay,#typed-strings,#typed-strings-delay,.scroll-down{display:none}#OpeningContentWrapper p,#welcometomysite,.homepage-subtitle{display:inline-block}.homepage-subtitle #typed,.typed-cursor{font-size:1.5em!important}.typed-cursor{margin-left:10px}@media only screen and (min-width:992px){#OpeningContentWrapper{padding-top:0;padding-right:120px}#welcometomysite{margin-left:.25em}#MusicOpeningWrapper,div#OpeningContentWrapperWrap{padding-left:0!important;padding-right:0!important}}#welcometomysite{font-size:2.5em}.post-img{width:100%;height:auto;max-height:200px}.homepage-subtitle{width:calc(100% - 20px);overflow:hidden;text-overflow:ellipsis;margin-left:10px;margin-right:10px}#BlogandMoreAboutSeconndWrapper .card{overflow:hidden}#BlogandMoreAboutSeconndWrapper .card .image{margin-left:-1rem;margin-right:-1rem;margin-top:-1rem}.post-button.ui.bottom.button{margin-left:-1em;margin-top:-.75em;margin-bottom:-1em;border-radius:0;padding-bottom:1em;background:#19034e;color:#fff;width:calc(100% - 1em)}#TwitterLinkWrap,.social-icon{margin-left:10px;margin-right:10px;display:inline-block}.social-icon{max-width:40px}#cookie-law{position:fixed;bottom:10px;right:10px;width:100%;max-width:320px;background:#f6f6f6;border:1px solid #333;z-index:999;padding:5px}#blogLoadMoreButton{margin-top:20px;background:#ddd;color:#000}div#customSpotifyRight{height:300px}div#customSpotifyRightElementSongWrapper{height:100%;position:relative}div#customSpotifyRightElementSongContainer{height:100%;background-size:cover}div#customSpotifyRightElementSongOverlay{position:absolute;top:0;left:0;background:0 0;width:100%;height:100%;color:#fff}div#nowPlayingOverlay{position:absolute;right:0;top:0;background:#0b0444;padding:10px}#customSpotifyLeft,#customSpotifyRight,.leftSideSong div,a.trackLinkFloat{padding:0!important}div#customSpotifyRightElementSongOverlayContent{margin-top:100px}.trackLinkPlay svg{max-width:50px;fill:#fff;margin-top:10px}.trackLinkPlay svg path{fill:#fff}div#customSpotifyRightElementSongOverlayContent span,div#spotifyOpenerWrapper{display:inline-block;width:100%}div#spotifyOpenerWrapper{margin-top:50px;border-top:1px solid #ddd;border-bottom:1px solid}.leftSideSong{background:#000;color:#fff;position:relative}a.trackLinkFloat{position:absolute;top:0;left:0;width:100%;height:100%;margin:0!important;z-index:999}div#customSpotifyLeftElementSongWrapper{margin-top:15px;background:#000}.leftSideSong,div#spotify-widget{margin-left:0!important;margin-right:0!important}#spotify-widget{margin-top:20px!important}.leftSideSong.ui.grid{border-bottom:1px solid;padding-bottom:5px;padding-top:5px}.leftSideSong h3{margin-top:0;margin-bottom:0;font-size:1em}.leftSideSong span{margin-right:5px;font-size:.8em}div#customSpotifyLeft{max-height:150px;overflow-y:scroll;overflow-x:hidden}div#mainOpeningContentWrap{margin:10vh 0 0;display:flex}div#OpeningContentWrapper{text-align:left}@media only screen and (min-width:992px){#OpeningContentWrapper p img{max-height:2.5em;height:auto;margin-bottom:0;margin-top:0;width:auto}}@media only screen and (max-width:992px){#OpeningContentWrapper p img{max-height:5em;height:auto;margin-bottom:0;margin-top:0;width:auto}h2#welcometomysite{width:100%}}span#MusicOpeningWrapperTitle{display:inline-block;width:100%;margin-top:20px}div#spotify-widget{height:450px}.social-icon-wrap{font-size:2.4em;color:#000}#TwitterLinkWrap{color:#1da1f2}a#LinkedinLinkWrap{color:#0077b5}.coloured-container{background:#19034e;padding-bottom:250px;margin-top:100px}.coloured-float-container{margin-top:-250px;margin-bottom:100px}#ExtraContentWrapper{margin-top:150px;margin-bottom:150px}#SkillsContentContainer{margin-top:50px}.column.icon-grid-item{padding:0!important;text-align:center}.icon-grid-item img{max-width:50px!important}.icon-grid-item span{width:100%;display:inline-block;margin-top:10px}#SkillsContentContainer h3{margin-bottom:50px;margin-top:50px;display:inline-block;width:100%}.cookies.js-cookie-message{position:fixed;bottom:20px;right:0;max-width:320px;width:100%;z-index:9999;background:#fff;border-radius:4px;padding:1rem;border:1px solid #ddd;box-shadow:0 0 10px 0 rgba(0,0,0,.1)}.cookies__box button{width:100%;padding:.5rem;background:0;border-color:#171f32;color:#171f32;font-weight:600;border-radius:4px}body{margin:0;padding:0;font-family:sans-serif}header{background:#000;width:calc(100% - 2rem);padding:1rem}.text-normal{text-align:left;text-align:initial}header .site-title-header{display:inline-block;width:auto;font-size:1.5rem;color:#a3a7ae;font-weight:600}header .site-title-header a{text-decoration:none;color:#a3a7ae}header .site-links-header{display:inline-block;float:right}header .site-links-header a{color:#485569;text-transform:uppercase;text-decoration:none;font-size:1rem;padding:.25rem;display:inline-block}header a:hover{color:#fff!important}.ui.container{display:block;max-width:100%!important}@media only screen and (max-width:767px){.ui.container,.ui.grid.container,.ui.relaxed.grid.container,.ui.very.relaxed.grid.container{width:auto!important}.ui.container{margin-left:1em!important;margin-right:1em!important}}@media only screen and (min-width:768px) and (max-width:991px){.ui.container{width:723px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(723px + 2rem)!important}.ui.relaxed.grid.container{width:calc(723px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(723px + 5rem)!important}}@media only screen and (min-width:992px) and (max-width:1199px){.ui.container{width:933px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(933px + 2rem)!important}.ui.relaxed.grid.container{width:calc(933px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(933px + 5rem)!important}}@media only screen and (min-width:1200px){.ui.container{width:1127px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(1127px + 2rem)!important}.ui.relaxed.grid.container{width:calc(1127px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(1127px + 5rem)!important}}#BlogContentContainer .card .image{max-height:220px;overflow:hidden}.repo-language-color{border-radius:50%;display:inline-block;height:12px;position:relative;top:1px;width:12px;background-color:#19034e}#githubReposContainer{margin:0;padding-top:1rem}.PHP .repo-language-color{background-color:#777bb4}.HTML .repo-language-color{background-color:#e34f25}.CSS .repo-language-color{background-color:#1372b6}.JavaScript .repo-language-color{background-color:#f7df1c}.repo-language-color{margin-right:5px!important}.card .content a.header{text-decoration:none;margin-bottom:5px}pre{background:#272727;color:#fff;padding:20px;white-space:pre-wrap;font-size:16px;font-family:Menlo,Monaco,Courier New,Courier,monospace;overflow:auto}.post-content-sidebar{max-width:320px}.App-content{top:0!important;margin-top:90vh}.single-page .App-content{top:0!important;margin-top:0!important}.social-icon-wrap svg{width:32px;height:auto}#TwitterLinkWrap svg,#TwitterLinkWrap svg path{fill:#1da1f2!important}#LinkedinLinkWrap svg,#LinkedinLinkWrap svg path{fill:#0077b5}.social-icon-wrap:hover svg{opacity:.6}@media only screen and (max-width:768px){.App-header.full-height-header{height:100%;padding-top:20px}}#MusicOpeningWrapperTitle svg{width:14px;display:inline-block;-webkit-transform:rotate(180deg);transform:rotate(180deg)}img.lazy.loaded{opacity:1!important}.alert.alert-danger{color:#d22d2d}.alert{width:100%;margin-bottom:20px;text-align:left}.button-block{display:block;width:100%}.button{border:0;outline:0;border-radius:0;padding:15px 0;font-size:22px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;background:0 0;color:#fff;transition:all .5s ease;-webkit-appearance:none}.header-single-image-full img{width:100%;height:auto;top:50%;transition:translateY(-50%);position:relative}.post-header-titles{max-width:780px;margin:-70px auto auto;background:#fff;z-index:99;position:relative;padding:1rem}.header-single-image-full{max-height:500px;overflow:hidden;width:100%;height:auto;vertical-align:middle;display:block}.single-page .App-header{height:auto!important;padding-top:0!important;position:relative}.single-page .App-content{top:0!important;padding:1rem;text-align:left;min-height:150px;width:calc(100% - 2rem)}img.post-image{width:100%;height:auto}.post-content-wrap{max-width:780px;width:calc(100% - 2rem);margin:auto;padding:1rem}.post-buttons-wrapper .button{background:#000;font-size:.7rem;opacity:1;border-radius:4px;padding:1rem;cursor:pointer}.post-buttons-wrapper{margin-top:.5rem}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><script type="text/javascript" async src="https://www.google-analytics.com/analytics.js"></script> <script async src="https://www.googletagmanager.com/gtm.js?id=GTM-NK46QBJ"></script> <script>
  (function(w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
      &quot;gtm.start&quot;: new Date().getTime(),
      event: &quot;gtm.js&quot;
    });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != &quot;dataLayer&quot; ? &quot;&amp;l=&quot; + l : &quot;&quot;;
    j.async = true;
    j.src = &quot;https://www.googletagmanager.com/gtm.js?id=&quot; + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, &quot;script&quot;, &quot;dataLayer&quot;, &quot;GTM-NK46QBJ&quot;);
    </script> <header><div class="ui container text-normal"><span class="site-title-header"><a href="https://nicholasgriffin.dev">
            Nicholas Griffin
        </a></span> <div class="site-links-header"><a href="https://nicholasgriffin.dev">
                Home
            </a></div></div></header> <div><div class="single-page"><div class="header-single-image-full"><img src="https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+20.24.38.png" alt="Adding Service Worker to my site" loading="lazy"></div> <div class="App-content"><div class="ui container"><div class="post-header"><div class="post-header-titles"><h1 id="single-title" class="animated bounceInDown">Adding Service Worker to my site</h1> <h2><div class="post-buttons-wrapper"></div></h2></div></div> <div class="post-content-wrap"><p>Service Workers have been around for quite a¬† while now and are awesome little JavaScript that can change the value that your site provides from behind something tethered to a mobile connection to a fully fledged progressive web app, ready for consumption on the mobile web, wherever your users are.</p>
<p>I remember being one of the first people I saw integrating them on sites back when I was¬† managing my technology blog, TechNNutty, allowing me to dramatically reduce the loading¬† time of that site without having the spend more money than I had to, for that reason alone, Service Workers are a no brainer for any website, top that with the ability to save content for offline consumption, send push notifications and more and you have the solution for modern websites, without any integration mess.</p>
<p>So if you haven‚Äôt already, I would definitely advice following through this and getting set up with your own Service Worker set up.</p>
<h2>Before we begin</h2>
<p>Before you¬† start building a Service Worker, you should definitely read up on the topic from various sources, they‚Äôll know and explain it a lot better than me. <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">Google has some great articles and posts about all things Service Worker</a>.</p>
<p>You should also note that Service Worker is bound to a particular scope, that means it can only be installed and can only control a singular domain, usually your main root domain so you may want to think about your application structure before getting placing code.</p>
<p>That last part also means that you need access to your websites, root directory. You also cannot host a Service Worker on a CDN.</p>
<p>That‚Äôs still not all.</p>
<p>You also need to be using HTTPS across your site (You will be able to load it on localhost on Chrome for dev) and you should note that Service Worker is currently only supported on selected browsers Jake Archibald‚Äôs¬†<a href="https://jakearchibald.github.io/isserviceworkerready/">is Serviceworker ready</a> site is a great place to check the status of support for various Service Worker related features.</p>
<h2>Getting your app to register a Service Worker</h2>
<p>Thanks to the browser‚Äôs implementation of the Service Worker spec, it‚Äôs actually really easy to get started and¬† register a Service Worker, so before we actually create any code, that will be the first part that we will complete.</p>
<p>Here‚Äôs the code that I‚Äôm using on¬† this¬† site:</p>
<pre><code class="javascript"><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">"DOMContentLoaded"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
    <span class="hljs-comment">// Load the service worker         </span>
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator) { 
        navigator.serviceWorker.register(<span class="hljs-string">'/serviceworker.js'</span>, { <span class="hljs-attr">scope</span>: <span class="hljs-string">'/'</span>})            .then( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> registration</span>) </span>{
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Service Worker successfully registered for`</span>, registration.scope);
            })
            .catch( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> error </span>) </span>{
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ServiceWorker not registered: <span class="hljs-subst">${error}</span>`</span>);
            });
        <span class="hljs-keyword">if</span>(navigator.serviceWorker.controller) {
            <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                navigator.serviceWorker.controller.postMessage({<span class="hljs-string">'command'</span>: <span class="hljs-string">'trimCaches'</span>});
            })
        }
    }
});
</code></pre>
<p>Basically, this waits for the DOM to lo load, checks for Service Worker support and then installs SW if it is supported.</p>
<p>The part that actually installs the script is the following line:</p>
<pre><code class="javascript">    navigator.serviceWorker.register(<span class="hljs-string">'/serviceworker.js'</span>, { <span class="hljs-attr">scope</span>: <span class="hljs-string">'/'</span>});
</code></pre>
<p>This basically says what the path to the file is and the scope that Service Worker should use.</p>
<p>As you can see, this also use promises, so you can also throw in some validation checking and reporting.</p>
<p>I‚Äôve also added a postMessage for trimming the cache, which we will get to later.</p>
<h2>Installing your Service Worker</h2>
<p>Now it is time to get started on the creation of your Service Worker file, for this I am naming my file ‚Äòserviceworker.js‚Äô but you can call it whatever you like.</p>
<p>At the start of the file, you should add some global variables to make your life easier further down the line. My globals look like this:</p>
<pre><code class="javascript">    <span class="hljs-comment">// The names for our caches and the version number </span>
    <span class="hljs-keyword">const</span> version = <span class="hljs-string">"-v1.0.5"</span>; 
    <span class="hljs-keyword">const</span> staticCache = <span class="hljs-string">"cachedFiles"</span> + version; 
    <span class="hljs-keyword">const</span> pagesCache = <span class="hljs-string">"cachedPages"</span>; 
    <span class="hljs-keyword">const</span> imagesCache = <span class="hljs-string">"cachedImages"</span>; 
    <span class="hljs-keyword">const</span> cacheList = [staticCache, pagesCache, imagesCache];  
    <span class="hljs-comment">// Our list of paths to cache on install </span>
    <span class="hljs-keyword">const</span> pagesToCache = [<span class="hljs-string">"/"</span>, <span class="hljs-string">"/offline"</span>];  
    <span class="hljs-comment">// Static files to cache on install </span>
    <span class="hljs-keyword">const</span> staticsToCache = [   <span class="hljs-string">"static/js/typed.min.js"</span>,   <span class="hljs-string">"static/js/nghpjs.js"</span>,   <span class="hljs-string">"static/js/lazyload.min.js"</span> ];
</code></pre>
<p>They are all pretty self-explanatory, but what I am basically doing here is naming our caches and setting what files should be cached on install. If you are creating an offline-ready PWA, you should include an offline page here as well that displays some sort of message to your offline users.</p>
<p>Mine‚Äôs pretty simplistic:</p>
<p><img src="https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+20.56.30.png" alt=""></p>
<p>I also added the following function that stores the¬† files so I don‚Äôt have to repeat myself a lot:</p>
<pre><code class="javascript">    <span class="hljs-comment">// The names for our caches and the version number </span>
    <span class="hljs-keyword">const</span> version = <span class="hljs-string">"-v1.0.5"</span>; 
    <span class="hljs-keyword">const</span> staticCache = <span class="hljs-string">"cachedFiles"</span> + version; 
    <span class="hljs-keyword">const</span> pagesCache = <span class="hljs-string">"cachedPages"</span>; 
    <span class="hljs-keyword">const</span> imagesCache = <span class="hljs-string">"cachedImages"</span>; 
    <span class="hljs-keyword">const</span> cacheList = [staticCache, pagesCache, imagesCache];  
    <span class="hljs-comment">// Our list of paths to cache on install </span>
    <span class="hljs-keyword">const</span> pagesToCache = [<span class="hljs-string">"/"</span>, <span class="hljs-string">"/offline"</span>];  
    <span class="hljs-comment">// Static files to cache on install </span>
    <span class="hljs-keyword">const</span> staticsToCache = [   <span class="hljs-string">"static/js/typed.min.js"</span>,   <span class="hljs-string">"static/js/nghpjs.js"</span>,   <span class="hljs-string">"static/js/lazyload.min.js"</span> ];
</code></pre>
<p>From here, the install event is as easy as the following:</p>
<pre><code class="javascript">    <span class="hljs-comment">// Install event will trigger when first initated </span>
    addEventListener(<span class="hljs-string">"install"</span>, installEvent => {   skipWaiting();   
        <span class="hljs-comment">// tell the browser to delay the SW installation until cache is populated   </span>
        installEvent.waitUntil(     
            <span class="hljs-comment">// now populate the cache (cache the files) using the Cache API     </span>
            <span class="hljs-comment">// 1\. Open the cache     </span>
            caches.open(staticCache).then(<span class="hljs-function"><span class="hljs-params">staticCache</span> =></span> {       
                <span class="hljs-comment">// Cache pages       </span>
                caches.open(pagesCache).then(<span class="hljs-function"><span class="hljs-params">pagesCache</span> =></span> {         
                    pagesCache.addAll(pagesToCache);       
                });        
                <span class="hljs-keyword">return</span> staticCache.addAll(staticsToCache);     
            })   
        ); 
    });
</code></pre>
<p>This simply listens for the install event and then adds all of the base files to our cache.</p>
<p>The ‚ÄòskipWaiting()‚Äô callback is optional here, it basically forces the waiting service worker to become the active service worker right away.</p>
<h2>Caching and returning requests from Service Worker</h2>
<p>As Service Worker pretty much controls your network requests, you‚Äôll also need to set up a fetch event, this will tell Service¬† Worker what to cache and how to respond to requests.</p>
<p>You can do this as simply as the following:</p>
<pre><code class="javascript">    self.addEventListener(<span class="hljs-string">'fetch'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{   
        event.respondWith(     
            caches.match(event.request)       
            .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{         
                <span class="hljs-comment">// Cache hit - return response         </span>
                <span class="hljs-keyword">if</span> (response) {           
                    <span class="hljs-keyword">return</span> response;         
                }          
                <span class="hljs-keyword">return</span> fetch(event.request).then(           
                    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{             
                        <span class="hljs-comment">// Check if we received a valid response             </span>
                        <span class="hljs-keyword">if</span>(!response || response.status !== <span class="hljs-number">200</span> || response.type !== <span class="hljs-string">'basic'</span>) {               
                            <span class="hljs-keyword">return</span> response;             
                        }              
                        <span class="hljs-comment">// IMPORTANT: Clone the response. A response is a stream      // and because we want the browser to consume the response    // as well as the cache consuming the response, we need       // to clone it so we have two streams.             </span>
                        <span class="hljs-keyword">var</span> responseToCache = response.clone();              caches.open(CACHE_NAME)               
                        .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cache</span>) </span>{                 
                            cache.put(event.request, responseToCache);               
                        });              
                        <span class="hljs-keyword">return</span> response;           
                    }         
                );       
            })     
        ); 
    });
</code></pre>
<p>That example is from <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">Google‚Äôs post</a>, for my own site, I¬† took things a little further than that as I wanted to separate caches and how they were handled.</p>
<pre><code class="javascript">    <span class="hljs-comment">// trigger this event when a path is requested </span>
    addEventListener(<span class="hljs-string">"fetch"</span>, fetchEvent => {   
        <span class="hljs-keyword">const</span> request = fetchEvent.request;    
        <span class="hljs-comment">// Check if the request URL is from us, otherwise ignore it   </span>
        <span class="hljs-keyword">if</span> (     request.url.indexOf(<span class="hljs-string">"https://nicholasgriffin.dev"</span>) ||     request.url.indexOf(<span class="hljs-string">"http://localhost:8080"</span>)   ) {
</code></pre>
<p>To start, I added an indexOf to check if the requested¬† URL was from my own domain, as I don‚Äôt want to cache other resources (this can break your site pretty easily), later down the line, I could expand this to add third-party caching for resources that I know work with Service Worker, like my CDN for example, for know I am simply ignoring other domains.</p>
<p>I then split my¬† caching into three sections.</p>
<p><strong>HTML Resources</strong></p>
<pre><code class="javascript">    <span class="hljs-keyword">if</span> (request.headers.get(<span class="hljs-string">"Accept"</span>).includes(<span class="hljs-string">"text/html"</span>)) {       
        <span class="hljs-comment">// respons with this if a page       </span>
        fetchEvent.respondWith(         
            fetch(request)           
            .then(<span class="hljs-function"><span class="hljs-params">responseFromFetch</span> =></span> {             
                <span class="hljs-keyword">const</span> copy = responseFromFetch.clone();              
                fetchEvent.waitUntil(               
                    caches.open(pagesCache).then(<span class="hljs-function"><span class="hljs-params">pagesCache</span> =></span> {                 
                        pagesCache.put(request, copy);               
                    })             
                );              
                <span class="hljs-keyword">return</span> responseFromFetch;           
            })           
            <span class="hljs-comment">// If the response errors           </span>
            .catch(<span class="hljs-function"><span class="hljs-params">error</span> =></span> {             
                <span class="hljs-keyword">return</span> caches.match(request).then(<span class="hljs-function"><span class="hljs-params">responseFromCache</span> =></span> {
                    <span class="hljs-keyword">if</span> (responseFromCache) {                 
                        <span class="hljs-keyword">return</span> responseFromCache;               
                    }                
                    <span class="hljs-comment">// serve offlie page               </span>
                    <span class="hljs-keyword">return</span> caches.match(<span class="hljs-string">"/offline"</span>);             
                });           
            })       
        );        
        <span class="hljs-keyword">return</span>;     
    }
</code></pre>
<p><strong>Image Resources</strong></p>
<pre><code class="javascript">    <span class="hljs-comment">// Check if the request is for an image     </span>
    <span class="hljs-keyword">if</span> (request.headers.get(<span class="hljs-string">"Accept"</span>).includes(<span class="hljs-string">"image"</span>)) {       
        fetchEvent.respondWith(         
            caches.match(request).then(<span class="hljs-function"><span class="hljs-params">responseFromCache</span> =></span> {           
                <span class="hljs-comment">// If the image is already in the cache, return it           </span>
                <span class="hljs-keyword">if</span> (responseFromCache) {             
                    fetchEvent.waitUntil(stashInCache(request, imagesCache));
                    <span class="hljs-keyword">return</span> responseFromCache;           
                } <span class="hljs-keyword">else</span> {             
                    <span class="hljs-keyword">return</span> (               
                        fetch(request)                 
                        .then(<span class="hljs-function"><span class="hljs-params">responseFromFetch</span> =></span> {                   
                            <span class="hljs-keyword">const</span> copy = responseFromFetch.clone();
                            fetchEvent.waitUntil(                     
                                caches.open(imagesCache).then(<span class="hljs-function"><span class="hljs-params">imageCache</span> =></span> {
                                    imageCache.put(request, copy);
                                })                   
                            );                   
                            <span class="hljs-keyword">return</span> responseFromFetch;                 
                        })                 
                        <span class="hljs-comment">// If the response errors                 </span>
                        .catch(<span class="hljs-function"><span class="hljs-params">error</span> =></span> {                   
                            <span class="hljs-keyword">return</span> caches.match(<span class="hljs-string">"/offline.png"</span>);                 
                        })             
                    );           
                }         
            })       
        );        
        <span class="hljs-keyword">return</span>;    
    }
</code></pre>
<p><strong>Everything else</strong></p>
<pre><code class="javascript">    <span class="hljs-comment">// for everything else     </span>
    fetchEvent.respondWith(       
        caches.match(request).then(<span class="hljs-function"><span class="hljs-params">responseFromCache</span> =></span> {         
            fetchEvent.waitUntil(           
                fetch(request).then(<span class="hljs-function"><span class="hljs-params">responseFromFetch</span> =></span> {             
                    caches.open(pagesCache).then(<span class="hljs-function"><span class="hljs-params">pagesCache</span> =></span> {               
                        <span class="hljs-keyword">return</span> pagesCache.put(request, responseFromFetch);
                    });           
                })         
            );         
            <span class="hljs-keyword">return</span> responseFromCache;       
        })     
    );
</code></pre>
<p>And from that point, you‚Äôll have a pretty mean Service Worker. But there is a bit more that¬† you can do.</p>
<h2>Updating the Service Worker</h2>
<p>One pretty important task is to add an ‚Äòactivate‚Äô event listener. This is important as it will allow you to clear out any old cache files.</p>
<p>I‚Äôm doing that will the following:</p>
<pre><code class="javascript">    addEventListener(<span class="hljs-string">"activate"</span>, activateEvent => {
  activateEvent.waitUntil(
    <span class="hljs-comment">// Clean up caches and clear old ones on activate</span>
    caches
      .keys()
      .then(<span class="hljs-function"><span class="hljs-params">cacheNames</span> =></span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(
          cacheNames.map(<span class="hljs-function"><span class="hljs-params">cacheName</span> =></span> {
            <span class="hljs-keyword">if</span> (!cacheList.includes(cacheName)) {
              <span class="hljs-keyword">return</span> caches.delete(cacheName);
            }
          })
        );
      })
      .then(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {
        <span class="hljs-keyword">return</span> clients.claim();
      })
  );
});
</code></pre>
<p>I also have the following function for trimming the cache on every page load so that it doesn‚Äôt load to much on my user‚Äôs machines.</p>
<p>This is done with¬† the following via the PostMessage that I mentioned earlier, limiting the pagesCache and imagesCache to 30:</p>
<pre><code class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trimCache</span>(<span class="hljs-params">cacheName, maxItems</span>) </span>{
  caches.open(cacheName).then(<span class="hljs-function"><span class="hljs-params">cache</span> =></span> {
    cache.keys().then(<span class="hljs-function"><span class="hljs-params">keys</span> =></span> {
      <span class="hljs-keyword">if</span> (keys.length > maxItems) {
        cache.delete(keys[<span class="hljs-number">0</span>]).then(trimCache(cacheName, maxItems));
      }
    });
  });
}
</code></pre>
<p>I don‚Äôt include the staticCache in this as I pretty much always want those resources cached.</p>
<h2>And that‚Äôs it</h2>
<p>Pretty easy right?</p>
<p>If you‚Äôd like to see my complete code and don‚Äôt fancy taking a look through Developer Tools, <a href="https://github.com/nicholasgriffintn/NG_Website_SW">I‚Äôve uploaded it to my Github here</a>.</p>
<p>When even a tractor can be fast, your site should be, no question.</p>
<p><img src="https://media.giphy.com/media/pZEwBYdHdN2s8/giphy.gif" alt=""></p>
</div></div></div></div> <link rel="stylesheet" href="/css/dracula.min.css"> <script>
  window.onload = function() {
    if (&quot;serviceWorker&quot; in navigator) {
      const offlineButton = document.createElement(&quot;button&quot;);

      offlineButton.className = &quot;button&quot;;

      caches.open(&quot;SavedPages&quot;).then(function(cache) {
        cache.match(window.location.href).then(function(result) {
          if (result) {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText =
              &quot;This page is ready for offline reading üëçüèª&quot;;
            offlineButton.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          } else {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText = &quot;Save this page for offline reading&quot;;
          }
        });
      });

      caches.open(&quot;cachedPages&quot;).then(function(cache) {
        cache.match(window.location.href).then(function(result) {
          if (result) {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText =
              &quot;This page is ready for offline reading üëçüèª&quot;;
            offlineButton.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          } else {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText = &quot;Save this page&quot;;
          }
        });
      });

      offlineButton.addEventListener(&quot;click&quot;, function(ev) {
        ev.preventDefault();

        var btn = this;

        btn.innerText = &quot;Saving...&quot;;

        caches.open(&quot;SavedPages&quot;).then(function(cache) {
          cache.add(window.location.href).then(function() {
            const data = {
              title: document.querySelector(&quot;title&quot;).innerText
            };

            localStorage.setItem(window.location.href, JSON.stringify(data));

            btn.innerText = &quot;This page is ready for offline reading üëçüèª&quot;;
            btn.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          });
        });
      });
    }
  };
    </script></div> <div hidden class="cookies js-cookie-message"><div class="cookies__box"><p><strong>
            Another üç™
            notification.
          </strong> <br>Sorry to bug you, I know these are annoying, just letting you know that I
          am
          using cookies on this site to track analytics, annoymously of course.
        </p> <button class="button button--primary">That's fine</button></div></div> <link href="/css/main.15f091f2.css" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> <script>window.Promise||document.write("&lt;script src=&quot;js/es6-promise.min.js&quot; &gt;&lt;/script&gt;"),window.fetch||document.write("&lt;script src=&quot;js/fetch.min.js&quot;&gt;&lt;/script&gt;")</script> <script type="text/javascript">
    window.addEventListener(&quot;DOMContentLoaded&quot;, function (event) {
        // Load the service worker
        if ('serviceWorker' in navigator) {

            navigator.serviceWorker.register('/serviceworker.js', { scope: '/'}) 

            .then( function( registration) {
                console.log(`Service Worker successfully registered for`, registration.scope);
            } )

            .catch( function( error ) {
                console.log(`ServiceWorker not registered: ${error}`);
            } );

            if(navigator.serviceWorker.controller) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.controller.postMessage({'command': 'trimCaches'});
                })
            }
        }
    });
</script> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NK46QBJ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript></div></div></div><script>window.__NUXT__=function(s,e,a,n,t,o,c,r,l,p,i){return{layout:"default",data:[{attributes:{title:t,published:s,description:o,tags:n,thumbnail:e,header:e,ctime:new Date(1558224e6)},content:'<p>Service Workers have been around for quite a¬† while now and are awesome little JavaScript that can change the value that your site provides from behind something tethered to a mobile connection to a fully fledged progressive web app, ready for consumption on the mobile web, wherever your users are.</p>\n<p>I remember being one of the first people I saw integrating them on sites back when I was¬† managing my technology blog, TechNNutty, allowing me to dramatically reduce the loading¬† time of that site without having the spend more money than I had to, for that reason alone, Service Workers are a no brainer for any website, top that with the ability to save content for offline consumption, send push notifications and more and you have the solution for modern websites, without any integration mess.</p>\n<p>So if you haven‚Äôt already, I would definitely advice following through this and getting set up with your own Service Worker set up.</p>\n<h2>Before we begin</h2>\n<p>Before you¬† start building a Service Worker, you should definitely read up on the topic from various sources, they‚Äôll know and explain it a lot better than me. <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">Google has some great articles and posts about all things Service Worker</a>.</p>\n<p>You should also note that Service Worker is bound to a particular scope, that means it can only be installed and can only control a singular domain, usually your main root domain so you may want to think about your application structure before getting placing code.</p>\n<p>That last part also means that you need access to your websites, root directory. You also cannot host a Service Worker on a CDN.</p>\n<p>That‚Äôs still not all.</p>\n<p>You also need to be using HTTPS across your site (You will be able to load it on localhost on Chrome for dev) and you should note that Service Worker is currently only supported on selected browsers Jake Archibald‚Äôs¬†<a href="https://jakearchibald.github.io/isserviceworkerready/">is Serviceworker ready</a> site is a great place to check the status of support for various Service Worker related features.</p>\n<h2>Getting your app to register a Service Worker</h2>\n<p>Thanks to the browser‚Äôs implementation of the Service Worker spec, it‚Äôs actually really easy to get started and¬† register a Service Worker, so before we actually create any code, that will be the first part that we will complete.</p>\n<p>Here‚Äôs the code that I‚Äôm using on¬† this¬† site:</p>\n<pre><code class="javascript"><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">"DOMContentLoaded"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{\n    <span class="hljs-comment">// Load the service worker         </span>\n    <span class="hljs-keyword">if</span> (<span class="hljs-string">\'serviceWorker\'</span> <span class="hljs-keyword">in</span> navigator) { \n        navigator.serviceWorker.register(<span class="hljs-string">\'/serviceworker.js\'</span>, { <span class="hljs-attr">scope</span>: <span class="hljs-string">\'/\'</span>})            .then( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> registration</span>) </span>{\n                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Service Worker successfully registered for`</span>, registration.scope);\n            })\n            .catch( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> error </span>) </span>{\n                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ServiceWorker not registered: <span class="hljs-subst">${error}</span>`</span>);\n            });\n        <span class="hljs-keyword">if</span>(navigator.serviceWorker.controller) {\n            <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">\'load\'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{\n                navigator.serviceWorker.controller.postMessage({<span class="hljs-string">\'command\'</span>: <span class="hljs-string">\'trimCaches\'</span>});\n            })\n        }\n    }\n});\n</code></pre>\n<p>Basically, this waits for the DOM to lo load, checks for Service Worker support and then installs SW if it is supported.</p>\n<p>The part that actually installs the script is the following line:</p>\n<pre><code class="javascript">    navigator.serviceWorker.register(<span class="hljs-string">\'/serviceworker.js\'</span>, { <span class="hljs-attr">scope</span>: <span class="hljs-string">\'/\'</span>});\n</code></pre>\n<p>This basically says what the path to the file is and the scope that Service Worker should use.</p>\n<p>As you can see, this also use promises, so you can also throw in some validation checking and reporting.</p>\n<p>I‚Äôve also added a postMessage for trimming the cache, which we will get to later.</p>\n<h2>Installing your Service Worker</h2>\n<p>Now it is time to get started on the creation of your Service Worker file, for this I am naming my file ‚Äòserviceworker.js‚Äô but you can call it whatever you like.</p>\n<p>At the start of the file, you should add some global variables to make your life easier further down the line. My globals look like this:</p>\n<pre><code class="javascript">    <span class="hljs-comment">// The names for our caches and the version number </span>\n    <span class="hljs-keyword">const</span> version = <span class="hljs-string">"-v1.0.5"</span>; \n    <span class="hljs-keyword">const</span> staticCache = <span class="hljs-string">"cachedFiles"</span> + version; \n    <span class="hljs-keyword">const</span> pagesCache = <span class="hljs-string">"cachedPages"</span>; \n    <span class="hljs-keyword">const</span> imagesCache = <span class="hljs-string">"cachedImages"</span>; \n    <span class="hljs-keyword">const</span> cacheList = [staticCache, pagesCache, imagesCache];  \n    <span class="hljs-comment">// Our list of paths to cache on install </span>\n    <span class="hljs-keyword">const</span> pagesToCache = [<span class="hljs-string">"/"</span>, <span class="hljs-string">"/offline"</span>];  \n    <span class="hljs-comment">// Static files to cache on install </span>\n    <span class="hljs-keyword">const</span> staticsToCache = [   <span class="hljs-string">"static/js/typed.min.js"</span>,   <span class="hljs-string">"static/js/nghpjs.js"</span>,   <span class="hljs-string">"static/js/lazyload.min.js"</span> ];\n</code></pre>\n<p>They are all pretty self-explanatory, but what I am basically doing here is naming our caches and setting what files should be cached on install. If you are creating an offline-ready PWA, you should include an offline page here as well that displays some sort of message to your offline users.</p>\n<p>Mine‚Äôs pretty simplistic:</p>\n<p><img src="https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+20.56.30.png" alt=""></p>\n<p>I also added the following function that stores the¬† files so I don‚Äôt have to repeat myself a lot:</p>\n<pre><code class="javascript">    <span class="hljs-comment">// The names for our caches and the version number </span>\n    <span class="hljs-keyword">const</span> version = <span class="hljs-string">"-v1.0.5"</span>; \n    <span class="hljs-keyword">const</span> staticCache = <span class="hljs-string">"cachedFiles"</span> + version; \n    <span class="hljs-keyword">const</span> pagesCache = <span class="hljs-string">"cachedPages"</span>; \n    <span class="hljs-keyword">const</span> imagesCache = <span class="hljs-string">"cachedImages"</span>; \n    <span class="hljs-keyword">const</span> cacheList = [staticCache, pagesCache, imagesCache];  \n    <span class="hljs-comment">// Our list of paths to cache on install </span>\n    <span class="hljs-keyword">const</span> pagesToCache = [<span class="hljs-string">"/"</span>, <span class="hljs-string">"/offline"</span>];  \n    <span class="hljs-comment">// Static files to cache on install </span>\n    <span class="hljs-keyword">const</span> staticsToCache = [   <span class="hljs-string">"static/js/typed.min.js"</span>,   <span class="hljs-string">"static/js/nghpjs.js"</span>,   <span class="hljs-string">"static/js/lazyload.min.js"</span> ];\n</code></pre>\n<p>From here, the install event is as easy as the following:</p>\n<pre><code class="javascript">    <span class="hljs-comment">// Install event will trigger when first initated </span>\n    addEventListener(<span class="hljs-string">"install"</span>, installEvent =&gt; {   skipWaiting();   \n        <span class="hljs-comment">// tell the browser to delay the SW installation until cache is populated   </span>\n        installEvent.waitUntil(     \n            <span class="hljs-comment">// now populate the cache (cache the files) using the Cache API     </span>\n            <span class="hljs-comment">// 1\\. Open the cache     </span>\n            caches.open(staticCache).then(<span class="hljs-function"><span class="hljs-params">staticCache</span> =&gt;</span> {       \n                <span class="hljs-comment">// Cache pages       </span>\n                caches.open(pagesCache).then(<span class="hljs-function"><span class="hljs-params">pagesCache</span> =&gt;</span> {         \n                    pagesCache.addAll(pagesToCache);       \n                });        \n                <span class="hljs-keyword">return</span> staticCache.addAll(staticsToCache);     \n            })   \n        ); \n    });\n</code></pre>\n<p>This simply listens for the install event and then adds all of the base files to our cache.</p>\n<p>The ‚ÄòskipWaiting()‚Äô callback is optional here, it basically forces the waiting service worker to become the active service worker right away.</p>\n<h2>Caching and returning requests from Service Worker</h2>\n<p>As Service Worker pretty much controls your network requests, you‚Äôll also need to set up a fetch event, this will tell Service¬† Worker what to cache and how to respond to requests.</p>\n<p>You can do this as simply as the following:</p>\n<pre><code class="javascript">    self.addEventListener(<span class="hljs-string">\'fetch\'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{   \n        event.respondWith(     \n            caches.match(event.request)       \n            .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{         \n                <span class="hljs-comment">// Cache hit - return response         </span>\n                <span class="hljs-keyword">if</span> (response) {           \n                    <span class="hljs-keyword">return</span> response;         \n                }          \n                <span class="hljs-keyword">return</span> fetch(event.request).then(           \n                    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{             \n                        <span class="hljs-comment">// Check if we received a valid response             </span>\n                        <span class="hljs-keyword">if</span>(!response || response.status !== <span class="hljs-number">200</span> || response.type !== <span class="hljs-string">\'basic\'</span>) {               \n                            <span class="hljs-keyword">return</span> response;             \n                        }              \n                        <span class="hljs-comment">// IMPORTANT: Clone the response. A response is a stream      // and because we want the browser to consume the response    // as well as the cache consuming the response, we need       // to clone it so we have two streams.             </span>\n                        <span class="hljs-keyword">var</span> responseToCache = response.clone();              caches.open(CACHE_NAME)               \n                        .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cache</span>) </span>{                 \n                            cache.put(event.request, responseToCache);               \n                        });              \n                        <span class="hljs-keyword">return</span> response;           \n                    }         \n                );       \n            })     \n        ); \n    });\n</code></pre>\n<p>That example is from <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">Google‚Äôs post</a>, for my own site, I¬† took things a little further than that as I wanted to separate caches and how they were handled.</p>\n<pre><code class="javascript">    <span class="hljs-comment">// trigger this event when a path is requested </span>\n    addEventListener(<span class="hljs-string">"fetch"</span>, fetchEvent =&gt; {   \n        <span class="hljs-keyword">const</span> request = fetchEvent.request;    \n        <span class="hljs-comment">// Check if the request URL is from us, otherwise ignore it   </span>\n        <span class="hljs-keyword">if</span> (     request.url.indexOf(<span class="hljs-string">"https://nicholasgriffin.dev"</span>) ||     request.url.indexOf(<span class="hljs-string">"http://localhost:8080"</span>)   ) {\n</code></pre>\n<p>To start, I added an indexOf to check if the requested¬† URL was from my own domain, as I don‚Äôt want to cache other resources (this can break your site pretty easily), later down the line, I could expand this to add third-party caching for resources that I know work with Service Worker, like my CDN for example, for know I am simply ignoring other domains.</p>\n<p>I then split my¬† caching into three sections.</p>\n<p><strong>HTML Resources</strong></p>\n<pre><code class="javascript">    <span class="hljs-keyword">if</span> (request.headers.get(<span class="hljs-string">"Accept"</span>).includes(<span class="hljs-string">"text/html"</span>)) {       \n        <span class="hljs-comment">// respons with this if a page       </span>\n        fetchEvent.respondWith(         \n            fetch(request)           \n            .then(<span class="hljs-function"><span class="hljs-params">responseFromFetch</span> =&gt;</span> {             \n                <span class="hljs-keyword">const</span> copy = responseFromFetch.clone();              \n                fetchEvent.waitUntil(               \n                    caches.open(pagesCache).then(<span class="hljs-function"><span class="hljs-params">pagesCache</span> =&gt;</span> {                 \n                        pagesCache.put(request, copy);               \n                    })             \n                );              \n                <span class="hljs-keyword">return</span> responseFromFetch;           \n            })           \n            <span class="hljs-comment">// If the response errors           </span>\n            .catch(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {             \n                <span class="hljs-keyword">return</span> caches.match(request).then(<span class="hljs-function"><span class="hljs-params">responseFromCache</span> =&gt;</span> {\n                    <span class="hljs-keyword">if</span> (responseFromCache) {                 \n                        <span class="hljs-keyword">return</span> responseFromCache;               \n                    }                \n                    <span class="hljs-comment">// serve offlie page               </span>\n                    <span class="hljs-keyword">return</span> caches.match(<span class="hljs-string">"/offline"</span>);             \n                });           \n            })       \n        );        \n        <span class="hljs-keyword">return</span>;     \n    }\n</code></pre>\n<p><strong>Image Resources</strong></p>\n<pre><code class="javascript">    <span class="hljs-comment">// Check if the request is for an image     </span>\n    <span class="hljs-keyword">if</span> (request.headers.get(<span class="hljs-string">"Accept"</span>).includes(<span class="hljs-string">"image"</span>)) {       \n        fetchEvent.respondWith(         \n            caches.match(request).then(<span class="hljs-function"><span class="hljs-params">responseFromCache</span> =&gt;</span> {           \n                <span class="hljs-comment">// If the image is already in the cache, return it           </span>\n                <span class="hljs-keyword">if</span> (responseFromCache) {             \n                    fetchEvent.waitUntil(stashInCache(request, imagesCache));\n                    <span class="hljs-keyword">return</span> responseFromCache;           \n                } <span class="hljs-keyword">else</span> {             \n                    <span class="hljs-keyword">return</span> (               \n                        fetch(request)                 \n                        .then(<span class="hljs-function"><span class="hljs-params">responseFromFetch</span> =&gt;</span> {                   \n                            <span class="hljs-keyword">const</span> copy = responseFromFetch.clone();\n                            fetchEvent.waitUntil(                     \n                                caches.open(imagesCache).then(<span class="hljs-function"><span class="hljs-params">imageCache</span> =&gt;</span> {\n                                    imageCache.put(request, copy);\n                                })                   \n                            );                   \n                            <span class="hljs-keyword">return</span> responseFromFetch;                 \n                        })                 \n                        <span class="hljs-comment">// If the response errors                 </span>\n                        .catch(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {                   \n                            <span class="hljs-keyword">return</span> caches.match(<span class="hljs-string">"/offline.png"</span>);                 \n                        })             \n                    );           \n                }         \n            })       \n        );        \n        <span class="hljs-keyword">return</span>;    \n    }\n</code></pre>\n<p><strong>Everything else</strong></p>\n<pre><code class="javascript">    <span class="hljs-comment">// for everything else     </span>\n    fetchEvent.respondWith(       \n        caches.match(request).then(<span class="hljs-function"><span class="hljs-params">responseFromCache</span> =&gt;</span> {         \n            fetchEvent.waitUntil(           \n                fetch(request).then(<span class="hljs-function"><span class="hljs-params">responseFromFetch</span> =&gt;</span> {             \n                    caches.open(pagesCache).then(<span class="hljs-function"><span class="hljs-params">pagesCache</span> =&gt;</span> {               \n                        <span class="hljs-keyword">return</span> pagesCache.put(request, responseFromFetch);\n                    });           \n                })         \n            );         \n            <span class="hljs-keyword">return</span> responseFromCache;       \n        })     \n    );\n</code></pre>\n<p>And from that point, you‚Äôll have a pretty mean Service Worker. But there is a bit more that¬† you can do.</p>\n<h2>Updating the Service Worker</h2>\n<p>One pretty important task is to add an ‚Äòactivate‚Äô event listener. This is important as it will allow you to clear out any old cache files.</p>\n<p>I‚Äôm doing that will the following:</p>\n<pre><code class="javascript">    addEventListener(<span class="hljs-string">"activate"</span>, activateEvent =&gt; {\n  activateEvent.waitUntil(\n    <span class="hljs-comment">// Clean up caches and clear old ones on activate</span>\n    caches\n      .keys()\n      .then(<span class="hljs-function"><span class="hljs-params">cacheNames</span> =&gt;</span> {\n        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(\n          cacheNames.map(<span class="hljs-function"><span class="hljs-params">cacheName</span> =&gt;</span> {\n            <span class="hljs-keyword">if</span> (!cacheList.includes(cacheName)) {\n              <span class="hljs-keyword">return</span> caches.delete(cacheName);\n            }\n          })\n        );\n      })\n      .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {\n        <span class="hljs-keyword">return</span> clients.claim();\n      })\n  );\n});\n</code></pre>\n<p>I also have the following function for trimming the cache on every page load so that it doesn‚Äôt load to much on my user‚Äôs machines.</p>\n<p>This is done with¬† the following via the PostMessage that I mentioned earlier, limiting the pagesCache and imagesCache to 30:</p>\n<pre><code class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trimCache</span>(<span class="hljs-params">cacheName, maxItems</span>) </span>{\n  caches.open(cacheName).then(<span class="hljs-function"><span class="hljs-params">cache</span> =&gt;</span> {\n    cache.keys().then(<span class="hljs-function"><span class="hljs-params">keys</span> =&gt;</span> {\n      <span class="hljs-keyword">if</span> (keys.length &gt; maxItems) {\n        cache.delete(keys[<span class="hljs-number">0</span>]).then(trimCache(cacheName, maxItems));\n      }\n    });\n  });\n}\n</code></pre>\n<p>I don‚Äôt include the staticCache in this as I pretty much always want those resources cached.</p>\n<h2>And that‚Äôs it</h2>\n<p>Pretty easy right?</p>\n<p>If you‚Äôd like to see my complete code and don‚Äôt fancy taking a look through Developer Tools, <a href="https://github.com/nicholasgriffintn/NG_Website_SW">I‚Äôve uploaded it to my Github here</a>.</p>\n<p>When even a tractor can be fast, your site should be, no question.</p>\n<p><img src="https://media.giphy.com/media/pZEwBYdHdN2s8/giphy.gif" alt=""></p>\n'}],error:null,state:{bloglist:[{title:"Using Sentiment Analysis to test user interaction",published:s,description:"Using AWS Comprehend to perform Sentiment Analysis on comments.",tags:"javascript,AWS, AWS Comprehend, Machine Learning",thumbnail:a,header:a,ctime:"2019-05-20",slug:"5ce1f1631c9d440000cbc59c"},{title:"My weekend with AWS DeepRacer",published:s,description:"Here are the results of my weekend playing around with AWS DeepRacer",tags:"javascript,AWS, AWS DeepRacer, Machine Learning",thumbnail:c,header:c,ctime:r,slug:"5ce13a901c9d4400004275bd"},{title:t,published:s,description:o,tags:n,thumbnail:e,header:e,ctime:r,slug:"5ce1adde1c9d4400007337c6"},{title:"Adding authentication to our Express blog with Passport.js",published:s,description:"Time to make things secure",tags:"javascript,Node, Express, Passport.js,authentication",thumbnail:l,header:l,ctime:"2019-04-19",slug:"5c7c00ffa1e5fbe51cd94951"},{title:"How I built a blog with Node, Express and Mongo",published:s,description:"Let's get blogging!",tags:"javascript,Express,Node,Mongo",thumbnail:p,header:p,ctime:"2019-04-02",slug:"5c7be6e2a1e5fbe51cd94950"},{title:"Let's begin again...",published:s,description:"Nicholas Griffin V.Something",tags:"Meta",thumbnail:i,header:i,ctime:"2019-04-01",slug:"5c7af91ae6bdacc5ee62ecfe"}]},serverRendered:s}}(!0,"https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+20.24.38.png","https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-20+at+01.08.17.png","javascript,service worker","Adding Service Worker to my site","Whoops! I forgot to add Service Worker to my site. Probably about time to do that...","https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+12.19.03.png","2019-05-19","https://nicholasgriffin.dev/uploads/bp/2019/March/users_js.jpg","https://nicholasgriffin.dev/uploads/bp/2019/March/postman_addpost_2019.jpg","https://i.ibb.co/g6MPvkg/Screenshot-2019-03-02-at-21-45-38.jpg")</script><script src="/_nuxt/335238b4871730cf9f7d.js" defer></script><script src="/_nuxt/ad3882a62a81c04ccdbd.js" defer></script><script src="/_nuxt/d26db56abffc2e10e685.js" defer></script><script src="/_nuxt/ed5ca3c40fa941f82244.js" defer></script><script src="/_nuxt/8c50d3902d6da8d5999e.js" defer></script>
  </body>
</html>
