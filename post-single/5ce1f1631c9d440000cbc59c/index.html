<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="lang">
  <head data-n-head="">
    <title data-n-head="true">Using Sentiment Analysis to test user interaction | Nicholas Griffin</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="keywords" name="keywords" content="web developer,blogger,technology,founder,TechNutty"><meta data-n-head="true" data-hid="author" name="author" content="Nicholas Griffin"><meta data-n-head="true" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="true" data-hid="apple-mobile-web-app-title" name="apple-mobile-web-app-title" content="nicholasgriffin"><meta data-n-head="true" data-hid="theme-color" name="theme-color" content="#fff"><meta data-n-head="true" data-hid="og:type" name="og:type" property="og:type" content="website"><meta data-n-head="true" data-hid="og:title" name="og:title" property="og:title" content="nicholasgriffin"><meta data-n-head="true" data-hid="og:site_name" name="og:site_name" property="og:site_name" content="nicholasgriffin"><meta data-n-head="true" data-hid="og:description" name="og:description" property="og:description" content="My personal website"><meta data-n-head="true" data-hid="description" name="description" content="Using AWS Comprehend to perform Sentiment Analysis on comments."><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-57x57.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-60x60.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-72x72.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-76x76.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-114x114.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-120x120.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-144x144.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-180x180.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-32x32.png" sizes="32x32"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/android-chrome-192x192.png" sizes="192x192"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-96x96.png" sizes="96x96"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-16x16.png" sizes="16x16"><link data-n-head="true" rel="mask-icon" type="apple-touch-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5"><link data-n-head="true" name="apple-mobile-web-app-title" content="Nicholas Griffin"><link data-n-head="true" name="application-name" content="Nicholas Griffin"><link data-n-head="true" name="theme-color" content="#5bbad5"><link data-n-head="true" rel="manifest" href="/manifest.json"><link data-n-head="true" rel="shortcut icon" href="/_nuxt/icons/icon_64.8AAfD9L2mjc.png"><link data-n-head="true" rel="apple-touch-icon" href="/_nuxt/icons/icon_512.8AAfD9L2mjc.png" sizes="512x512"><link rel="preload" href="/_nuxt/374c35dcd568f77d8d47.js" as="script"><link rel="preload" href="/_nuxt/d26db56abffc2e10e685.js" as="script"><link rel="preload" href="/_nuxt/ed5ca3c40fa941f82244.js" as="script"><link rel="preload" href="/_nuxt/8c50d3902d6da8d5999e.js" as="script"><link rel="preload" href="/_nuxt/6b8a8582a5f82c0f1e06.js" as="script"><style data-vue-ssr-id="17cfdfa9:0 aab9a468:0 9a8fa946:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#fff;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}body,div#root{overflow-x:hidden}body,html{margin:0;padding:0;border:0;outline:0;vertical-align:baseline;background:0 0}.single-page .mid-box-background{padding-top:2rem;padding-bottom:2rem}.App{text-align:center}.App-header{position:fixed;top:0;left:0;width:100%;height:70vh;background-color:#222;padding:20vh 20px 20px;padding-left:0!important;color:#fff}.background-colours{opacity:.1}.background{position:absolute;top:0;right:0;bottom:0;left:0;background:#093054;background:-webkit-gradient(left top,right bottom,color-stop(0,#093054),color-stop(100%,#0b1042));background:linear-gradient(135deg,#093054,#0b1042)}.title-wrapper h1{font-size:3.1em!important;line-height:1.4;font-weight:700;color:#fff}.App-content{min-height:100vh;width:100vw;position:relative;background:#fff;z-index:9}.lazy{opacity:1;transition:opacity .3s}.lazy[data-src]{opacity:0}#OpeningContentWrapper img{max-height:80px;height:120px;margin-bottom:20px;margin-top:20px;width:auto}#BlogPostOpenerWrapper{display:inline-block;padding-top:40px;padding-bottom:40px;margin-top:20px;width:100%;color:#fff}#OpeningContentSocial a{text-decoration:none}#default-typed-strings,#second-typed-strings-delay,#third-typed-strings-delay,#typed-strings,#typed-strings-delay,.scroll-down{display:none}#OpeningContentWrapper p,#welcometomysite,.homepage-subtitle{display:inline-block}.homepage-subtitle #typed,.typed-cursor{font-size:1.5em!important}.typed-cursor{margin-left:10px}@media only screen and (min-width:992px){#OpeningContentWrapper{padding-top:0;padding-right:120px}#welcometomysite{margin-left:.25em}#MusicOpeningWrapper,div#OpeningContentWrapperWrap{padding-left:0!important;padding-right:0!important}}#welcometomysite{font-size:2.5em}.post-img{width:100%;height:auto;max-height:200px}.homepage-subtitle{width:calc(100% - 20px);overflow:hidden;text-overflow:ellipsis;margin-left:10px;margin-right:10px}#BlogandMoreAboutSeconndWrapper .card{overflow:hidden}#BlogandMoreAboutSeconndWrapper .card .image{margin-left:-1rem;margin-right:-1rem;margin-top:-1rem}.post-button.ui.bottom.button{margin-left:-1em;margin-top:-.75em;margin-bottom:-1em;border-radius:0;padding-bottom:1em;background:#19034e;color:#fff;width:calc(100% - 1em)}#TwitterLinkWrap,.social-icon{margin-left:10px;margin-right:10px;display:inline-block}.social-icon{max-width:40px}#cookie-law{position:fixed;bottom:10px;right:10px;width:100%;max-width:320px;background:#f6f6f6;border:1px solid #333;z-index:999;padding:5px}#blogLoadMoreButton{margin-top:20px;background:#ddd;color:#000}div#customSpotifyRight{height:300px}div#customSpotifyRightElementSongWrapper{height:100%;position:relative}div#customSpotifyRightElementSongContainer{height:100%;background-size:cover}div#customSpotifyRightElementSongOverlay{position:absolute;top:0;left:0;background:0 0;width:100%;height:100%;color:#fff}div#nowPlayingOverlay{position:absolute;right:0;top:0;background:#0b0444;padding:10px}#customSpotifyLeft,#customSpotifyRight,.leftSideSong div,a.trackLinkFloat{padding:0!important}div#customSpotifyRightElementSongOverlayContent{margin-top:100px}.trackLinkPlay svg{max-width:50px;fill:#fff;margin-top:10px}.trackLinkPlay svg path{fill:#fff}div#customSpotifyRightElementSongOverlayContent span,div#spotifyOpenerWrapper{display:inline-block;width:100%}div#spotifyOpenerWrapper{margin-top:50px;border-top:1px solid #ddd;border-bottom:1px solid}.leftSideSong{background:#000;color:#fff;position:relative}a.trackLinkFloat{position:absolute;top:0;left:0;width:100%;height:100%;margin:0!important;z-index:999}div#customSpotifyLeftElementSongWrapper{margin-top:15px;background:#000}.leftSideSong,div#spotify-widget{margin-left:0!important;margin-right:0!important}#spotify-widget{margin-top:20px!important}.leftSideSong.ui.grid{border-bottom:1px solid;padding-bottom:5px;padding-top:5px}.leftSideSong h3{margin-top:0;margin-bottom:0;font-size:1em}.leftSideSong span{margin-right:5px;font-size:.8em}div#customSpotifyLeft{max-height:150px;overflow-y:scroll;overflow-x:hidden}div#mainOpeningContentWrap{margin:10vh 0 0;display:flex}div#OpeningContentWrapper{text-align:left}@media only screen and (min-width:992px){#OpeningContentWrapper p img{max-height:2.5em;height:auto;margin-bottom:0;margin-top:0;width:auto}}@media only screen and (max-width:992px){#OpeningContentWrapper p img{max-height:5em;height:auto;margin-bottom:0;margin-top:0;width:auto}h2#welcometomysite{width:100%}}span#MusicOpeningWrapperTitle{display:inline-block;width:100%;margin-top:20px}div#spotify-widget{height:450px}.social-icon-wrap{font-size:2.4em;color:#000}#TwitterLinkWrap{color:#1da1f2}a#LinkedinLinkWrap{color:#0077b5}.coloured-container{background:#19034e;padding-bottom:250px;margin-top:100px}.coloured-float-container{margin-top:-250px;margin-bottom:100px}#ExtraContentWrapper{margin-top:150px;margin-bottom:150px}#SkillsContentContainer{margin-top:50px}.column.icon-grid-item{padding:0!important;text-align:center}.icon-grid-item img{max-width:50px!important}.icon-grid-item span{width:100%;display:inline-block;margin-top:10px}#SkillsContentContainer h3{margin-bottom:50px;margin-top:50px;display:inline-block;width:100%}.cookies.js-cookie-message{position:fixed;bottom:20px;right:0;max-width:320px;width:100%;z-index:9999;background:#fff;border-radius:4px;padding:1rem;border:1px solid #ddd;box-shadow:0 0 10px 0 rgba(0,0,0,.1)}.cookies__box button{width:100%;padding:.5rem;background:0;border-color:#171f32;color:#171f32;font-weight:600;border-radius:4px}body{margin:0;padding:0;font-family:sans-serif}header{background:#000;width:calc(100% - 2rem);padding:1rem}.text-normal{text-align:left;text-align:initial}header .site-title-header{display:inline-block;width:auto;font-size:1.5rem;color:#a3a7ae;font-weight:600}header .site-title-header a{text-decoration:none;color:#a3a7ae}header .site-links-header{display:inline-block;float:right}header .site-links-header a{color:#485569;text-transform:uppercase;text-decoration:none;font-size:1rem;padding:.25rem;display:inline-block}header a:hover{color:#fff!important}.ui.container{display:block;max-width:100%!important}@media only screen and (max-width:767px){.ui.container,.ui.grid.container,.ui.relaxed.grid.container,.ui.very.relaxed.grid.container{width:auto!important}.ui.container{margin-left:1em!important;margin-right:1em!important}}@media only screen and (min-width:768px) and (max-width:991px){.ui.container{width:723px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(723px + 2rem)!important}.ui.relaxed.grid.container{width:calc(723px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(723px + 5rem)!important}}@media only screen and (min-width:992px) and (max-width:1199px){.ui.container{width:933px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(933px + 2rem)!important}.ui.relaxed.grid.container{width:calc(933px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(933px + 5rem)!important}}@media only screen and (min-width:1200px){.ui.container{width:1127px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(1127px + 2rem)!important}.ui.relaxed.grid.container{width:calc(1127px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(1127px + 5rem)!important}}#BlogContentContainer .card .image{max-height:220px;overflow:hidden}.repo-language-color{border-radius:50%;display:inline-block;height:12px;position:relative;top:1px;width:12px;background-color:#19034e}#githubReposContainer{margin:0;padding-top:1rem}.PHP .repo-language-color{background-color:#777bb4}.HTML .repo-language-color{background-color:#e34f25}.CSS .repo-language-color{background-color:#1372b6}.JavaScript .repo-language-color{background-color:#f7df1c}.repo-language-color{margin-right:5px!important}.card .content a.header{text-decoration:none;margin-bottom:5px}pre{background:#272727;color:#fff;padding:20px;white-space:pre-wrap;font-size:16px;font-family:Menlo,Monaco,Courier New,Courier,monospace;overflow:auto}.post-content-sidebar{max-width:320px}.App-content{top:0!important;margin-top:90vh}.single-page .App-content{top:0!important;margin-top:0!important}.social-icon-wrap svg{width:32px;height:auto}#TwitterLinkWrap svg,#TwitterLinkWrap svg path{fill:#1da1f2!important}#LinkedinLinkWrap svg,#LinkedinLinkWrap svg path{fill:#0077b5}.social-icon-wrap:hover svg{opacity:.6}@media only screen and (max-width:768px){.App-header.full-height-header{height:100%;padding-top:20px}}#MusicOpeningWrapperTitle svg{width:14px;display:inline-block;-webkit-transform:rotate(180deg);transform:rotate(180deg)}img.lazy.loaded{opacity:1!important}.alert.alert-danger{color:#d22d2d}.alert{width:100%;margin-bottom:20px;text-align:left}.button-block{display:block;width:100%}.button{border:0;outline:0;border-radius:0;padding:15px 0;font-size:22px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;background:0 0;color:#fff;transition:all .5s ease;-webkit-appearance:none}.header-single-image-full img{width:100%;height:auto;top:50%;transition:translateY(-50%);position:relative}.post-header-titles{max-width:780px;margin:-70px auto auto;background:#fff;z-index:99;position:relative;padding:1rem}.header-single-image-full{max-height:500px;overflow:hidden;width:100%;height:auto;vertical-align:middle;display:block}.single-page .App-header{height:auto!important;padding-top:0!important;position:relative}.single-page .App-content{top:0!important;padding:1rem;text-align:left;min-height:150px;width:calc(100% - 2rem)}img.post-image{width:100%;height:auto}.post-content-wrap{max-width:780px;width:100%;margin:auto;padding:1rem}.post-buttons-wrapper .button{background:#000;font-size:.7rem;opacity:1;border-radius:4px;padding:1rem;cursor:pointer}.post-buttons-wrapper{margin-top:.5rem}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><script type="text/javascript" async src="https://www.google-analytics.com/analytics.js"></script> <script async src="https://www.googletagmanager.com/gtm.js?id=GTM-NK46QBJ"></script> <script>
  (function(w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
      &quot;gtm.start&quot;: new Date().getTime(),
      event: &quot;gtm.js&quot;
    });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != &quot;dataLayer&quot; ? &quot;&amp;l=&quot; + l : &quot;&quot;;
    j.async = true;
    j.src = &quot;https://www.googletagmanager.com/gtm.js?id=&quot; + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, &quot;script&quot;, &quot;dataLayer&quot;, &quot;GTM-NK46QBJ&quot;);
    </script> <header><div class="ui container text-normal"><span class="site-title-header"><a href="https://nicholasgriffin.dev">
            Nicholas Griffin
        </a></span> <div class="site-links-header"><a href="https://nicholasgriffin.dev">
                Home
            </a></div></div></header> <div><div class="single-page"><div class="header-single-image-full"><img src="https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-20+at+01.08.17.png" alt="Using Sentiment Analysis to test user interaction" loading="lazy"></div> <div class="App-content"><div class="ui container"><div class="post-header"><div class="post-header-titles"><h1 id="single-title" class="animated bounceInDown">Using Sentiment Analysis to test user interaction</h1> <h2><div class="post-buttons-wrapper"></div></h2></div></div> <div class="post-content-wrap"><p>So recently I attended the AWS Summit in London. There was a ton of new stuff to see at the show but alongside the DeepRacer demos, there was a clear focus on machine learning. Amazon has a ton of new machine learning tech to play with and I obviously want to take them up on that.</p>
<p>To kick things off, I wanted to see what I could do with their comprehend and recognition APIs as this seemed the most useful for the sort of work I do, in particular with user interaction.</p>
<p>One thing that I thought that would work really I particular would be a comments section, so that’s what I’m going to make today, a comments system that points out when a user might be writing something that might be offensive.</p>
<h2>How are we going to do that?</h2>
<p>There are a few places that you could go to for APIs that can do sentiment analysis, however, as I do prefer AWS, we will be using AWS Comprehend.</p>
<p>I like this API not only because I like AWS but also because it integrates well with AWS and is really simple to set up.</p>
<p>Obviously, in order to get started, you are going to need an AWS account and a credit/debit card behind it. That said, AWS Comprehend is actually pretty cheap and you only pay for what you use, on the free tier you’ll get 50K units of text or 5M characters for free to use for the APIs included within Comprehend, starting from your first request, aside from the custom Classification and Custom Entities APIs.</p>
<p>You can <a href="https://aws.amazon.com/comprehend/pricing/">view the rest of the pricing here</a>.</p>
<p>Alongside that, we will be setting up an API Gateway and a Lambda. To generate those I’ll be using the <a href="https://serverless.com/">Serverless Framework</a> because that’s a lot more fun.</p>
<h2>Setting up our Serverless environment</h2>
<p>Getting started with Serverless is really simple, just run the command ‘npm install serverless -g’ in your terminal window.</p>
<p>Once that’s done, you can create a base project with ‘serverless create --template aws-python3 --name comments-comprehend’ and then deploy it with ‘serverless deploy’ (after adding your AWS keys). You should find two files after generating your template, a handler.py file for your lambda code and a serverless.yaml file for your serverless config.</p>
<p>Simply change the names and values in both for what you’re creating.</p>
<p>You’ll also want to add the following to your provider config so that the iAM user created can access Comprehend, I have left this a wildcard, you should segment it down for application security.</p>
<pre><code class="yaml"><span class="hljs-attr">iamRoleStatements:</span> 
<span class="hljs-attr">- Effect:</span> <span class="hljs-string">Allow</span> <span class="hljs-attr">Action:</span> 
<span class="hljs-attr">- logs:</span><span class="hljs-string">CreateLogGroup</span> 
<span class="hljs-attr">- logs:</span><span class="hljs-string">CreateLogStream</span> 
<span class="hljs-attr">- logs:</span><span class="hljs-string">PutLogEvents</span> 
<span class="hljs-attr">- comprehend:</span><span class="hljs-string">DetectDominantLanguage</span> 
<span class="hljs-attr">- comprehend:</span><span class="hljs-string">DetectSentiment</span> 
<span class="hljs-attr">Resource:</span> <span class="hljs-string">"*"</span>
</code></pre>
<p>And that’s the first part of the serverless framework stuff done.</p>
<h2>Configuring your Lambda  function</h2>
<p>Now you want to head over to your handler.py file and start editing.</p>
<p>First add in the required imports:</p>
<pre><code class="python">    <span class="hljs-keyword">import</span> os, boto3, json
</code></pre>
<p>Then we are going to add a bit of code to show a message depending on the sentiment, one for negative comments and one for positive.</p>
<pre><code class="python">    NEGATIVE_COMMENT_MESSAGE=<span class="hljs-string">"Your comment is too negative to post, please edit it."</span>
    
    POSITIVE_COMMENT_MESSAGE=<span class="hljs-string">"Your comment looks great. Keep up the good work!"</span>
    
    client=boto3.client(<span class="hljs-string">'comprehend'</span>)
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sentimentAnalysis</span><span class="hljs-params">(event, context)</span>:</span> 
        inputTranscriptData=event[<span class="hljs-string">'queryStringParameters'</span>][<span class="hljs-string">'inputTranscript'</span>] 
        
        print(inputTranscriptData); 
        
        sentiment=client.detect_sentiment(Text=inputTranscriptData,LanguageCode=<span class="hljs-string">'en'</span>)[<span class="hljs-string">'Sentiment'</span>] 
        
        <span class="hljs-keyword">if</span> sentiment==<span class="hljs-string">'NEGATIVE'</span>: 
            <span class="hljs-keyword">return</span>{
                <span class="hljs-string">"statusCode"</span>: <span class="hljs-number">200</span>, 
                <span class="hljs-string">"body"</span>: json.dumps(NEGATIVE_COMMENT_MESSAGE)
            } 
        <span class="hljs-keyword">else</span>: 
            <span class="hljs-keyword">return</span>{
                <span class="hljs-string">"statusCode"</span>: <span class="hljs-number">200</span>, 
                <span class="hljs-string">"body"</span>: json.dumps(POSITIVE_COMMENT_MESSAGE)
            }
</code></pre>
<p>That’s obviously pretty simplistic, however, that might be just about all we need, we can expand it later.</p>
<p>Now you are ready to deploy that by running ‘Serverless Deploy’.</p>
<h2>Testing your function</h2>
<p>Once pushed, you can test your function from within the  AWS Management Console with the following test or something  similar:</p>
<pre><code class="json">    {
        <span class="hljs-attr">"queryStringParameters"</span>:{
            <span class="hljs-attr">"inputTranscript"</span>: <span class="hljs-string">"I love flowers"</span>
        }
    }
</code></pre>
<p>Feel to change it to see what you get back.</p>
<h2>Setting up API Gateway</h2>
<p>This should already be done for you by Serverless, you may want to  add some authentication,  if you don’t you can carry on, simply query your API Gateway domain with a query string of the text that you want to validate against, like the following:</p>
<p>https://47477fgdhd.execute-api.eu-west-1.amazonaws.com/dev/sentiment-analysis?inputTranscript=I Love Flowers</p>
<p>It should return a 200 response alongside your text if you did everything right.</p>
<h2>Linking everything together</h2>
<p>Now you just need to link the API Gateway to your front end. I built a simple front end form that show the validate message upon submit.</p>
<p>You can check that out alongside the rest of the code on my <a href="https://github.com/nicholasgriffintn/comments-comprehend">Github</a>. And if you are really interested, keep it bookmarked, I’ll be updating it soon.</p>
</div></div></div></div> <link rel="stylesheet" href="/css/dracula.min.css"> <script>
  window.onload = function() {
    if (&quot;serviceWorker&quot; in navigator) {
      const offlineButton = document.createElement(&quot;button&quot;);

      offlineButton.className = &quot;button&quot;;

      caches.open(&quot;SavedPages&quot;).then(function(cache) {
        cache.match(window.location.href).then(function(result) {
          if (result) {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText =
              &quot;This page is ready for offline reading 👍🏻&quot;;
            offlineButton.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          } else {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText = &quot;Save this page for offline reading&quot;;
          }
        });
      });

      caches.open(&quot;cachedPages&quot;).then(function(cache) {
        cache.match(window.location.href).then(function(result) {
          if (result) {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText =
              &quot;This page is ready for offline reading 👍🏻&quot;;
            offlineButton.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          } else {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText = &quot;Save this page&quot;;
          }
        });
      });

      offlineButton.addEventListener(&quot;click&quot;, function(ev) {
        ev.preventDefault();

        var btn = this;

        btn.innerText = &quot;Saving...&quot;;

        caches.open(&quot;SavedPages&quot;).then(function(cache) {
          cache.add(window.location.href).then(function() {
            const data = {
              title: document.querySelector(&quot;title&quot;).innerText
            };

            localStorage.setItem(window.location.href, JSON.stringify(data));

            btn.innerText = &quot;This page is ready for offline reading 👍🏻&quot;;
            btn.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          });
        });
      });
    }
  };
    </script></div> <div hidden class="cookies js-cookie-message"><div class="cookies__box"><p><strong>
            Another 🍪
            notification.
          </strong> <br>Sorry to bug you, I know these are annoying, just letting you know that I
          am
          using cookies on this site to track analytics, annoymously of course.
        </p> <button class="button button--primary">That's fine</button></div></div> <link href="/css/main.15f091f2.css" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> <script>window.Promise||document.write("&lt;script src=&quot;js/es6-promise.min.js&quot; &gt;&lt;/script&gt;"),window.fetch||document.write("&lt;script src=&quot;js/fetch.min.js&quot;&gt;&lt;/script&gt;")</script> <script type="text/javascript">
    window.addEventListener(&quot;DOMContentLoaded&quot;, function (event) {
        // Load the service worker
        if ('serviceWorker' in navigator) {

            navigator.serviceWorker.register('/serviceworker.js', { scope: '/'}) 

            .then( function( registration) {
                console.log(`Service Worker successfully registered for`, registration.scope);
            } )

            .catch( function( error ) {
                console.log(`ServiceWorker not registered: ${error}`);
            } );

            if(navigator.serviceWorker.controller) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.controller.postMessage({'command': 'trimCaches'});
                })
            }
        }
    });
</script> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NK46QBJ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript></div></div></div><script>window.__NUXT__=function(e,t,s,n,a,o,i,r,p,l,h){return{layout:"default",data:[{attributes:{title:a,published:e,description:o,tags:n,thumbnail:t,header:t,ctime:new Date(15583104e5)},content:'<p>So recently I attended the AWS Summit in London. There was a ton of new stuff to see at the show but alongside the DeepRacer demos, there was a clear focus on machine learning. Amazon has a ton of new machine learning tech to play with and I obviously want to take them up on that.</p>\n<p>To kick things off, I wanted to see what I could do with their comprehend and recognition APIs as this seemed the most useful for the sort of work I do, in particular with user interaction.</p>\n<p>One thing that I thought that would work really I particular would be a comments section, so that’s what I’m going to make today, a comments system that points out when a user might be writing something that might be offensive.</p>\n<h2>How are we going to do that?</h2>\n<p>There are a few places that you could go to for APIs that can do sentiment analysis, however, as I do prefer AWS, we will be using AWS Comprehend.</p>\n<p>I like this API not only because I like AWS but also because it integrates well with AWS and is really simple to set up.</p>\n<p>Obviously, in order to get started, you are going to need an AWS account and a credit/debit card behind it. That said, AWS Comprehend is actually pretty cheap and you only pay for what you use, on the free tier you’ll get 50K units of text or 5M characters for free to use for the APIs included within Comprehend, starting from your first request, aside from the custom Classification and Custom Entities APIs.</p>\n<p>You can <a href="https://aws.amazon.com/comprehend/pricing/">view the rest of the pricing here</a>.</p>\n<p>Alongside that, we will be setting up an API Gateway and a Lambda. To generate those I’ll be using the <a href="https://serverless.com/">Serverless Framework</a> because that’s a lot more fun.</p>\n<h2>Setting up our Serverless environment</h2>\n<p>Getting started with Serverless is really simple, just run the command ‘npm install serverless -g’ in your terminal window.</p>\n<p>Once that’s done, you can create a base project with ‘serverless create --template aws-python3 --name comments-comprehend’ and then deploy it with ‘serverless deploy’ (after adding your AWS keys). You should find two files after generating your template, a handler.py file for your lambda code and a serverless.yaml file for your serverless config.</p>\n<p>Simply change the names and values in both for what you’re creating.</p>\n<p>You’ll also want to add the following to your provider config so that the iAM user created can access Comprehend, I have left this a wildcard, you should segment it down for application security.</p>\n<pre><code class="yaml"><span class="hljs-attr">iamRoleStatements:</span> \n<span class="hljs-attr">- Effect:</span> <span class="hljs-string">Allow</span> <span class="hljs-attr">Action:</span> \n<span class="hljs-attr">- logs:</span><span class="hljs-string">CreateLogGroup</span> \n<span class="hljs-attr">- logs:</span><span class="hljs-string">CreateLogStream</span> \n<span class="hljs-attr">- logs:</span><span class="hljs-string">PutLogEvents</span> \n<span class="hljs-attr">- comprehend:</span><span class="hljs-string">DetectDominantLanguage</span> \n<span class="hljs-attr">- comprehend:</span><span class="hljs-string">DetectSentiment</span> \n<span class="hljs-attr">Resource:</span> <span class="hljs-string">"*"</span>\n</code></pre>\n<p>And that’s the first part of the serverless framework stuff done.</p>\n<h2>Configuring your Lambda  function</h2>\n<p>Now you want to head over to your handler.py file and start editing.</p>\n<p>First add in the required imports:</p>\n<pre><code class="python">    <span class="hljs-keyword">import</span> os, boto3, json\n</code></pre>\n<p>Then we are going to add a bit of code to show a message depending on the sentiment, one for negative comments and one for positive.</p>\n<pre><code class="python">    NEGATIVE_COMMENT_MESSAGE=<span class="hljs-string">"Your comment is too negative to post, please edit it."</span>\n    \n    POSITIVE_COMMENT_MESSAGE=<span class="hljs-string">"Your comment looks great. Keep up the good work!"</span>\n    \n    client=boto3.client(<span class="hljs-string">\'comprehend\'</span>)\n    \n    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sentimentAnalysis</span><span class="hljs-params">(event, context)</span>:</span> \n        inputTranscriptData=event[<span class="hljs-string">\'queryStringParameters\'</span>][<span class="hljs-string">\'inputTranscript\'</span>] \n        \n        print(inputTranscriptData); \n        \n        sentiment=client.detect_sentiment(Text=inputTranscriptData,LanguageCode=<span class="hljs-string">\'en\'</span>)[<span class="hljs-string">\'Sentiment\'</span>] \n        \n        <span class="hljs-keyword">if</span> sentiment==<span class="hljs-string">\'NEGATIVE\'</span>: \n            <span class="hljs-keyword">return</span>{\n                <span class="hljs-string">"statusCode"</span>: <span class="hljs-number">200</span>, \n                <span class="hljs-string">"body"</span>: json.dumps(NEGATIVE_COMMENT_MESSAGE)\n            } \n        <span class="hljs-keyword">else</span>: \n            <span class="hljs-keyword">return</span>{\n                <span class="hljs-string">"statusCode"</span>: <span class="hljs-number">200</span>, \n                <span class="hljs-string">"body"</span>: json.dumps(POSITIVE_COMMENT_MESSAGE)\n            }\n</code></pre>\n<p>That’s obviously pretty simplistic, however, that might be just about all we need, we can expand it later.</p>\n<p>Now you are ready to deploy that by running ‘Serverless Deploy’.</p>\n<h2>Testing your function</h2>\n<p>Once pushed, you can test your function from within the  AWS Management Console with the following test or something  similar:</p>\n<pre><code class="json">    {\n        <span class="hljs-attr">"queryStringParameters"</span>:{\n            <span class="hljs-attr">"inputTranscript"</span>: <span class="hljs-string">"I love flowers"</span>\n        }\n    }\n</code></pre>\n<p>Feel to change it to see what you get back.</p>\n<h2>Setting up API Gateway</h2>\n<p>This should already be done for you by Serverless, you may want to  add some authentication,  if you don’t you can carry on, simply query your API Gateway domain with a query string of the text that you want to validate against, like the following:</p>\n<p>https://47477fgdhd.execute-api.eu-west-1.amazonaws.com/dev/sentiment-analysis?inputTranscript=I Love Flowers</p>\n<p>It should return a 200 response alongside your text if you did everything right.</p>\n<h2>Linking everything together</h2>\n<p>Now you just need to link the API Gateway to your front end. I built a simple front end form that show the validate message upon submit.</p>\n<p>You can check that out alongside the rest of the code on my <a href="https://github.com/nicholasgriffintn/comments-comprehend">Github</a>. And if you are really interested, keep it bookmarked, I’ll be updating it soon.</p>\n'}],error:null,state:{bloglist:[{title:a,published:e,description:o,tags:n,thumbnail:t,header:t,ctime:"2019-05-20",slug:"5ce1f1631c9d440000cbc59c"},{title:"My weekend with AWS DeepRacer",published:e,description:"Here are the results of my weekend playing around with AWS DeepRacer",tags:"javascript,AWS, AWS DeepRacer, Machine Learning",thumbnail:s,header:s,ctime:i,slug:"5ce13a901c9d4400004275bd"},{title:"Adding Service Worker to my site",published:e,description:"Whoops! I forgot to add Service Worker to my site. Probably about time to do that...",tags:"javascript,service worker",thumbnail:r,header:r,ctime:i,slug:"5ce1adde1c9d4400007337c6"},{title:"Adding authentication to our Express blog with Passport.js",published:e,description:"Time to make things secure",tags:"javascript,Node, Express, Passport.js,authentication",thumbnail:p,header:p,ctime:"2019-04-19",slug:"5c7c00ffa1e5fbe51cd94951"},{title:"How I built a blog with Node, Express and Mongo",published:e,description:"Let's get blogging!",tags:"javascript,Express,Node,Mongo",thumbnail:l,header:l,ctime:"2019-04-02",slug:"5c7be6e2a1e5fbe51cd94950"},{title:"Let's begin again...",published:e,description:"Nicholas Griffin V.Something",tags:"Meta",thumbnail:h,header:h,ctime:"2019-04-01",slug:"5c7af91ae6bdacc5ee62ecfe"}]},serverRendered:e}}(!0,"https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-20+at+01.08.17.png","https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+12.19.03.png","javascript,AWS, AWS Comprehend, Machine Learning","Using Sentiment Analysis to test user interaction","Using AWS Comprehend to perform Sentiment Analysis on comments.","2019-05-19","https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+20.24.38.png","https://nicholasgriffin.dev/uploads/bp/2019/March/users_js.jpg","https://nicholasgriffin.dev/uploads/bp/2019/March/postman_addpost_2019.jpg","https://i.ibb.co/g6MPvkg/Screenshot-2019-03-02-at-21-45-38.jpg")</script><script src="/_nuxt/374c35dcd568f77d8d47.js" defer></script><script src="/_nuxt/6b8a8582a5f82c0f1e06.js" defer></script><script src="/_nuxt/d26db56abffc2e10e685.js" defer></script><script src="/_nuxt/ed5ca3c40fa941f82244.js" defer></script><script src="/_nuxt/8c50d3902d6da8d5999e.js" defer></script>
  </body>
</html>
