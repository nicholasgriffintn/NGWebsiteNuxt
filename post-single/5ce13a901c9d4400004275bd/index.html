<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="lang">
  <head data-n-head="">
    <title data-n-head="true">My weekend with AWS DeepRacer | Nicholas Griffin</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="keywords" name="keywords" content="web developer,blogger,technology,founder,TechNutty"><meta data-n-head="true" data-hid="author" name="author" content="Nicholas Griffin"><meta data-n-head="true" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="true" data-hid="apple-mobile-web-app-title" name="apple-mobile-web-app-title" content="nicholasgriffin"><meta data-n-head="true" data-hid="theme-color" name="theme-color" content="#fff"><meta data-n-head="true" data-hid="og:type" name="og:type" property="og:type" content="website"><meta data-n-head="true" data-hid="og:title" name="og:title" property="og:title" content="nicholasgriffin"><meta data-n-head="true" data-hid="og:site_name" name="og:site_name" property="og:site_name" content="nicholasgriffin"><meta data-n-head="true" data-hid="og:description" name="og:description" property="og:description" content="My personal website"><meta data-n-head="true" data-hid="description" name="description" content="Here are the results of my weekend playing around with AWS DeepRacer"><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-57x57.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-60x60.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-72x72.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-76x76.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-114x114.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-120x120.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-144x144.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-180x180.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-32x32.png" sizes="32x32"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/android-chrome-192x192.png" sizes="192x192"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-96x96.png" sizes="96x96"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-16x16.png" sizes="16x16"><link data-n-head="true" rel="mask-icon" type="apple-touch-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5"><link data-n-head="true" name="apple-mobile-web-app-title" content="Nicholas Griffin"><link data-n-head="true" name="application-name" content="Nicholas Griffin"><link data-n-head="true" name="theme-color" content="#5bbad5"><link data-n-head="true" rel="manifest" href="/manifest.json"><link data-n-head="true" rel="shortcut icon" href="/_nuxt/icons/icon_64.8AAfD9L2mjc.png"><link data-n-head="true" rel="apple-touch-icon" href="/_nuxt/icons/icon_512.8AAfD9L2mjc.png" sizes="512x512"><script data-n-head="true" src="//www.googletagmanager.com/gtm.js?id=GTM-NK46QBJ&l=dataLayer" async></script><link rel="preload" href="/_nuxt/08095cc0ddcff0005f18.js" as="script"><link rel="preload" href="/_nuxt/d7c75f6ac79d1786d22d.js" as="script"><link rel="preload" href="/_nuxt/cd4412461eab3e0f1742.js" as="script"><link rel="preload" href="/_nuxt/72ff58b2c4c4555793ba.js" as="script"><link rel="preload" href="/_nuxt/0a9df1c9c77a89bdd93f.js" as="script"><style data-vue-ssr-id="17cfdfa9:0 aab9a468:0 9a8fa946:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#fff;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}body,div#root{overflow-x:hidden}body,html{margin:0;padding:0;border:0;outline:0;vertical-align:baseline;background:0 0}.single-page .mid-box-background{padding-top:2rem;padding-bottom:2rem}.App{text-align:center}.App-header{position:fixed;top:0;left:0;width:100%;height:70vh;background-color:#222;padding:20vh 20px 20px;padding-left:0!important;color:#fff}.background-colours{opacity:.1}.background{position:absolute;top:0;right:0;bottom:0;left:0;background:#093054;background:-webkit-gradient(left top,right bottom,color-stop(0,#093054),color-stop(100%,#0b1042));background:linear-gradient(135deg,#093054,#0b1042)}.title-wrapper h1{font-size:3.1em!important;line-height:1.4;font-weight:700;color:#fff}.App-content{min-height:100vh;width:100vw;position:relative;background:#fff;z-index:9}.lazy{opacity:1;transition:opacity .3s}.lazy[data-src]{opacity:0}#OpeningContentWrapper img{max-height:80px;height:120px;margin-bottom:20px;margin-top:20px;width:auto}#BlogPostOpenerWrapper{display:inline-block;padding-top:40px;padding-bottom:40px;margin-top:20px;width:100%;color:#fff}#OpeningContentSocial a{text-decoration:none}#default-typed-strings,#second-typed-strings-delay,#third-typed-strings-delay,#typed-strings,#typed-strings-delay,.scroll-down{display:none}#OpeningContentWrapper p,#welcometomysite,.homepage-subtitle{display:inline-block}.homepage-subtitle #typed,.typed-cursor{font-size:1.5em!important}.typed-cursor{margin-left:10px}@media only screen and (min-width:992px){#OpeningContentWrapper{padding-top:0;padding-right:120px}#welcometomysite{margin-left:.25em}#MusicOpeningWrapper,div#OpeningContentWrapperWrap{padding-left:0!important;padding-right:0!important}}#welcometomysite{font-size:2.5em}.post-img{width:100%;height:auto;max-height:200px}.homepage-subtitle{width:calc(100% - 20px);overflow:hidden;text-overflow:ellipsis;margin-left:10px;margin-right:10px}#BlogandMoreAboutSeconndWrapper .card{overflow:hidden}#BlogandMoreAboutSeconndWrapper .card .image{margin-left:-1rem;margin-right:-1rem;margin-top:-1rem}.post-button.ui.bottom.button{margin-left:-1em;margin-top:-.75em;margin-bottom:-1em;border-radius:0;padding-bottom:1em;background:#19034e;color:#fff;width:calc(100% - 1em)}#TwitterLinkWrap,.social-icon{margin-left:10px;margin-right:10px;display:inline-block}.social-icon{max-width:40px}#cookie-law{position:fixed;bottom:10px;right:10px;width:100%;max-width:320px;background:#f6f6f6;border:1px solid #333;z-index:999;padding:5px}#blogLoadMoreButton{margin-top:20px;background:#ddd;color:#000}div#customSpotifyRight{height:300px}div#customSpotifyRightElementSongWrapper{height:100%;position:relative}div#customSpotifyRightElementSongContainer{height:100%;background-size:cover}div#customSpotifyRightElementSongOverlay{position:absolute;top:0;left:0;background:0 0;width:100%;height:100%;color:#fff}div#nowPlayingOverlay{position:absolute;right:0;top:0;background:#0b0444;padding:10px}#customSpotifyLeft,#customSpotifyRight,.leftSideSong div,a.trackLinkFloat{padding:0!important}div#customSpotifyRightElementSongOverlayContent{margin-top:100px}.trackLinkPlay svg{max-width:50px;fill:#fff;margin-top:10px}.trackLinkPlay svg path{fill:#fff}div#customSpotifyRightElementSongOverlayContent span,div#spotifyOpenerWrapper{display:inline-block;width:100%}div#spotifyOpenerWrapper{margin-top:50px;border-top:1px solid #ddd;border-bottom:1px solid}.leftSideSong{background:#000;color:#fff;position:relative}a.trackLinkFloat{position:absolute;top:0;left:0;width:100%;height:100%;margin:0!important;z-index:999}div#customSpotifyLeftElementSongWrapper{margin-top:15px;background:#000}.leftSideSong,div#spotify-widget{margin-left:0!important;margin-right:0!important}#spotify-widget{margin-top:20px!important}.leftSideSong.ui.grid{border-bottom:1px solid;padding-bottom:5px;padding-top:5px}.leftSideSong h3{margin-top:0;margin-bottom:0;font-size:1em}.leftSideSong span{margin-right:5px;font-size:.8em}div#customSpotifyLeft{max-height:150px;overflow-y:scroll;overflow-x:hidden}div#mainOpeningContentWrap{margin:10vh 0 0;display:flex}div#OpeningContentWrapper{text-align:left}@media only screen and (min-width:992px){#OpeningContentWrapper p img{max-height:2.5em;height:auto;margin-bottom:0;margin-top:0;width:auto}}@media only screen and (max-width:992px){#OpeningContentWrapper p img{max-height:5em;height:auto;margin-bottom:0;margin-top:0;width:auto}h2#welcometomysite{width:100%}}span#MusicOpeningWrapperTitle{display:inline-block;width:100%;margin-top:20px}div#spotify-widget{height:450px}.social-icon-wrap{font-size:2.4em;color:#000}#TwitterLinkWrap{color:#1da1f2}a#LinkedinLinkWrap{color:#0077b5}.coloured-container{background:#19034e;padding-bottom:250px;margin-top:100px}.coloured-float-container{margin-top:-250px;margin-bottom:100px}#ExtraContentWrapper{margin-top:150px;margin-bottom:150px}#SkillsContentContainer{margin-top:50px}.column.icon-grid-item{padding:0!important;text-align:center}.icon-grid-item img{max-width:50px!important}.icon-grid-item span{width:100%;display:inline-block;margin-top:10px}#SkillsContentContainer h3{margin-bottom:50px;margin-top:50px;display:inline-block;width:100%}.cookies.js-cookie-message{position:fixed;bottom:20px;right:0;max-width:320px;width:100%;z-index:9999;background:#fff;border-radius:4px;padding:1rem;border:1px solid #ddd;box-shadow:0 0 10px 0 rgba(0,0,0,.1)}.cookies__box button{width:100%;padding:.5rem;background:0;border-color:#171f32;color:#171f32;font-weight:600;border-radius:4px}body{margin:0;padding:0;font-family:sans-serif}header{background:#000;width:calc(100% - 2rem);padding:1rem}.text-normal{text-align:left;text-align:initial}header .site-title-header{display:inline-block;width:auto;font-size:1.5rem;color:#a3a7ae;font-weight:600}header .site-title-header a{text-decoration:none;color:#a3a7ae}header .site-links-header{display:inline-block;float:right}header .site-links-header a{color:#485569;text-transform:uppercase;text-decoration:none;font-size:1rem;padding:.25rem;display:inline-block}header a:hover{color:#fff!important}.ui.container{display:block;max-width:100%!important}@media only screen and (max-width:767px){.ui.container,.ui.grid.container,.ui.relaxed.grid.container,.ui.very.relaxed.grid.container{width:auto!important}.ui.container{margin-left:1em!important;margin-right:1em!important}}@media only screen and (min-width:768px) and (max-width:991px){.ui.container{width:723px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(723px + 2rem)!important}.ui.relaxed.grid.container{width:calc(723px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(723px + 5rem)!important}}@media only screen and (min-width:992px) and (max-width:1199px){.ui.container{width:933px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(933px + 2rem)!important}.ui.relaxed.grid.container{width:calc(933px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(933px + 5rem)!important}}@media only screen and (min-width:1200px){.ui.container{width:1127px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(1127px + 2rem)!important}.ui.relaxed.grid.container{width:calc(1127px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(1127px + 5rem)!important}}#BlogContentContainer .card .image{max-height:220px;overflow:hidden}.repo-language-color{border-radius:50%;display:inline-block;height:12px;position:relative;top:1px;width:12px;background-color:#19034e}#githubReposContainer{margin:0;padding-top:1rem}.PHP .repo-language-color{background-color:#777bb4}.HTML .repo-language-color{background-color:#e34f25}.CSS .repo-language-color{background-color:#1372b6}.JavaScript .repo-language-color{background-color:#f7df1c}.repo-language-color{margin-right:5px!important}.card .content a.header{text-decoration:none;margin-bottom:5px}pre{background:#272727;color:#fff;padding:20px;white-space:pre-wrap;font-size:16px;font-family:Menlo,Monaco,Courier New,Courier,monospace;overflow:auto}.post-content-sidebar{max-width:320px}.App-content{top:0!important;margin-top:90vh}.single-page .App-content{top:0!important;margin-top:0!important}.social-icon-wrap svg{width:32px;height:auto}#TwitterLinkWrap svg,#TwitterLinkWrap svg path{fill:#1da1f2!important}#LinkedinLinkWrap svg,#LinkedinLinkWrap svg path{fill:#0077b5}.social-icon-wrap:hover svg{opacity:.6}@media only screen and (max-width:768px){.App-header.full-height-header{height:100%;padding-top:20px}}#MusicOpeningWrapperTitle svg{width:14px;display:inline-block;-webkit-transform:rotate(180deg);transform:rotate(180deg)}img.lazy.loaded{opacity:1!important}.alert.alert-danger{color:#d22d2d}.alert{width:100%;margin-bottom:20px;text-align:left}.button-block{display:block;width:100%}.button{border:0;outline:0;border-radius:0;padding:15px 0;font-size:22px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;background:0 0;color:#fff;transition:all .5s ease;-webkit-appearance:none}.header-single-image-full img{width:100%;height:auto;top:50%;transition:translateY(-50%);position:relative}.post-header-titles{max-width:780px;margin:-70px auto auto;background:#fff;z-index:99;position:relative;padding:1rem}.header-single-image-full{max-height:500px;overflow:hidden;width:100%;height:auto;vertical-align:middle;display:block}.single-page .App-header{height:auto!important;padding-top:0!important;position:relative}.single-page .App-content{top:0!important;padding:1rem;text-align:left;min-height:150px;width:calc(100% - 2rem)}img.post-image{width:100%;height:auto}.post-content-wrap{max-width:780px;width:calc(100% - 2rem);margin:auto;padding:1rem}.post-buttons-wrapper .button{background:#000;font-size:.7rem;opacity:1;border-radius:4px;padding:1rem;cursor:pointer}.post-buttons-wrapper{margin-top:.5rem}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><header><div class="ui container text-normal"><span class="site-title-header"><a href="https://nicholasgriffin.dev">
            Nicholas Griffin
        </a></span> <div class="site-links-header"><a href="https://nicholasgriffin.dev">
                Home
            </a></div></div></header> <div><div class="single-page"><div class="header-single-image-full"><img src="https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+12.19.03.png" alt="My weekend with AWS DeepRacer" loading="lazy"></div> <div class="App-content"><div class="ui container"><div class="post-header"><div class="post-header-titles"><h1 id="single-title" class="animated bounceInDown">My weekend with AWS DeepRacer</h1> <h2><div class="post-buttons-wrapper"></div></h2></div></div> <div class="post-content-wrap"><p>Last weekend marked the beginning of Amazon‚Äôs new virtual DeepRacer league, which is basically a race that is conducted within Amazon‚Äôs platform by a bunch of simulated versions of the¬† DeepRacer vehicle.</p>
<p>Developers battle it out in this league not by their driving skill but by their knowledge of the AWS platform and their ability to effectively create and train a DeepRacer model on AWS‚Äô platform.¬† As you can tell by the title, this was immediately something that I thought I would be interested in, if not at least just for the weekend and I‚Äôd have to say that I definitely had fun doing it.</p>
<h2>Getting Started</h2>
<p>The whole process of getting started with AWS DeepRacer and concept of Reinforcement Learning is a slightly scary one at first sight, this is something that you‚Äôve probably never done before and at times, Amazon‚Äôs slightly jarring interface can be a little confusing.</p>
<p>Thankfully, it isn‚Äôt actually that hard to do. Simply head on over to the <a href="https://console.aws.amazon.com/deepracer/">AWS DeepRacer</a> page in your console and hit the orange ‚ÄòGet Started‚Äô button,¬† that will take you to another page where you need to click another button in order to create the resources required.</p>
<p><img src="https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+12.28.57.png" alt=""></p>
<p>There‚Äôs also a link to a document about learning RL on this page that you should definitely check out.</p>
<p>Once you‚Äôve done all that, you are ready to start making some models and get spending some money and yes, you will have to spend a bit of money, DeepRacer is definitely not for the light of wallet, more on that later.</p>
<h2>Creating a DeepRacer model</h2>
<p>So probably the hardest part of this journey with DeepRacer was the creation of RL models for use with the simulation, while the actual creation¬† of the models simply¬† involves some Python code that you can create in pretty much any IDE, getting a model correct can be a lot of trial and error and a lot of the time,¬† you will¬† end up with an error.</p>
<p>Sadly, a lot of your success will also be linked to the training settings that you select for your DeepRacer model and while you can do¬† a lot with your own code, sometimes you might end up having to scrap all of the training that you have conducted in order to slightly change a¬† setting with a value that is more than likely¬† to be an utter¬† guess.</p>
<p>Then you‚Äôll likely have to do at least an hour or two of training before you can get racing.</p>
<p>That said, I¬† can‚Äôt say that I¬† didn‚Äôt find the experience enjoyable, nor that I didn‚Äôt learn anything from, nor that I didn‚Äôt have any fun.</p>
<p><img src="https://cdn.nicholasgriffin.dev/images/aawsdeeprace.gif" alt=""></p>
<p>As¬† you can see from the GIF above, there are a lot of options, but it actually isn‚Äôt that hard to get one going fast.</p>
<p>In total, I created 19 models over the weekend, and each one gradually started to get a little better, somewhat smarter and a lot faster.</p>
<p>At the start, I decided to use one of Amazon‚Äôs templates to see how everything worked and to get a quick glimpse into what I could expect, so i used the following function, which is designed to train to car to keep within the two borders and hopefully on the center linne.</p>
<pre><code class="python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reward_function</span><span class="hljs-params">(params)</span>:</span>     
    <span class="hljs-string">'''     
    Example of rewarding the agent to follow center line     
    '''</span>          
    <span class="hljs-comment"># Read input parameters     </span>
    track_width = params[<span class="hljs-string">'track_width'</span>]     
    distance_from_center = params[<span class="hljs-string">'distance_from_center'</span>]          
    <span class="hljs-comment"># Calculate 3 markers that are at varying distances away from the center line     </span>
    marker_1 = <span class="hljs-number">0.1</span> * track_width     
    marker_2 = <span class="hljs-number">0.25</span> * track_width     
    marker_3 = <span class="hljs-number">0.5</span> * track_width          
    <span class="hljs-comment"># Give higher reward if the car is closer to center line and vice versa     </span>
    <span class="hljs-keyword">if</span> distance_from_center &lt;= marker_1:
    reward = <span class="hljs-number">1.0</span>     
    <span class="hljs-keyword">elif</span> distance_from_center &lt;= marker_2:
    reward = <span class="hljs-number">0.5</span>     
    <span class="hljs-keyword">elif</span> distance_from_center &lt;= marker_3:
    reward = <span class="hljs-number">0.1</span>     
    <span class="hljs-keyword">else</span>:         
    reward = <span class="hljs-number">1e-3</span>  <span class="hljs-comment"># likely crashed/ close to off track          </span>
    <span class="hljs-keyword">return</span> float(reward)
</code></pre>
<p>As you can see it is actually quite simple but involves quite a lot of math. The premise is that the more that your car does what you want it to, the more reward value you provide. if it does something that you don‚Äôt want itt to, you take the reward away.</p>
<p>So in this example, the car will get the highest reward if it is closer to the center line.</p>
<p>For this first one, I did only that and then used the default settings.</p>
<p><img src="https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+13.04.21.png" alt=""></p>
<p>The great thing about DeepRacer is that you can actually watch a live stream of your model training in the simulation while it is doing so. This means that you can quickly see where you could make optimisations to your model and what optimisations you should probably tone down.</p>
<p>Should your model look like it‚Äôs not panning out, you can also quickly stoop the training and save some money.</p>
<p>Once my model had finished, I worked out that although it was occasionally steering to the center for those points, it was not staying there for a long period of time and even sometimes going off the track.</p>
<p>Thankfully, Amazon has already set up a range of parameters that will allow you to customise your reward function¬† and get the most out of it.</p>
<pre><code class="python">    {     
        <span class="hljs-string">"all_wheels_on_track"</span>: Boolean,    
        <span class="hljs-comment"># flag to indicate if the vehicle is on the track     </span>
        <span class="hljs-string">"x"</span>: float,                        
        <span class="hljs-comment"># vehicle's x-coordinate in meters     </span>
        <span class="hljs-string">"y"</span>: float,                        
        <span class="hljs-comment"># vehicle's y-coordinate in meters     </span>
        <span class="hljs-string">"distance_from_center"</span>: float,     
        <span class="hljs-comment"># distance in meters from the track center      </span>
        <span class="hljs-string">"is_left_of_center"</span>: Boolean,      
        <span class="hljs-comment"># Flag to indicate if the vehicle is on the left side to the track center or not.      </span>
        <span class="hljs-string">"heading"</span>: float,                  
        <span class="hljs-comment"># vehicle's yaw in degrees     </span>
        <span class="hljs-string">"progress"</span>: float,                 
        <span class="hljs-comment"># percentage of track completed     </span>
        <span class="hljs-string">"steps"</span>: int,                      
        <span class="hljs-comment"># number steps completed     </span>
        <span class="hljs-string">"speed"</span>: float,                    
        <span class="hljs-comment"># vehicle's speed in meters per second (m/s)     </span>
        <span class="hljs-string">"steering_angle"</span>: float,          
        <span class="hljs-comment"># vehicle's steering angle in degrees     </span>
        <span class="hljs-string">"track_width"</span>: float,              
        <span class="hljs-comment"># width of the track     </span>
        <span class="hljs-string">"waypoints"</span>: [[float, float], ‚Ä¶ ], 
        <span class="hljs-comment"># list of [x,y] as milestones along the track center     </span>
        <span class="hljs-string">"closest_waypoints"</span>: [int, int]    
        <span class="hljs-comment"># indices of the two nearest waypoints. </span>
    }
</code></pre>
<p>So what I did was combine the default with a multiplier for the car‚Äôs progress while being in the center of the track.</p>
<pre><code class="python">     Give higher reward <span class="hljs-keyword">if</span> the car <span class="hljs-keyword">is</span> closer to center line <span class="hljs-keyword">and</span> vice versa     
     <span class="hljs-keyword">if</span> distance_from_center &lt;= marker_1:         
        reward = <span class="hljs-number">1.0</span> * progress     
     <span class="hljs-keyword">elif</span> distance_from_center &lt;= marker_2:         
        reward = <span class="hljs-number">0.5</span>     
    <span class="hljs-keyword">elif</span> distance_from_center &lt;= marker_3:         
        reward = <span class="hljs-number">0.1</span>     
    <span class="hljs-keyword">else</span>:         
        reward = <span class="hljs-number">1e-3</span>  <span class="hljs-comment"># likely crashed/ close to off track</span>
</code></pre>
<p>I also wanted it to go faster, while not steering to much so I added the following:</p>
<pre><code class="python">        <span class="hljs-comment"># Add penalty if throttle exsides the steering else add reward     </span>
        <span class="hljs-keyword">if</span> abs(steering_angle) > <span class="hljs-number">15</span> <span class="hljs-keyword">and</span> abs(steering_angle > throttle):         
            reward *= <span class="hljs-number">1</span> - (steering_angle - throttle)     
        <span class="hljs-keyword">else</span>:         
            reward *= <span class="hljs-number">1</span> + throttle
</code></pre>
<p>And then I had to increase the speed on the action parameters as well, this is the part where you have more risk in changing your parameters, as you can‚Äôt change the parameters on a cloned model, only a new one and once you create a new model, you lose all of your progress and training, but keeping the defaults will definitely mean that you will not be able to progress through the league as much.</p>
<p>You can also play around with the HyperParameters to optimise your training, however, this is again a bit of trail and error.</p>
<p>For me, once I did that, I was able to get a good training session from my model and finally submitted my first decent score of 28:350 o the London Loop, which at the time put me at rank 145.</p>
<p>I then trained the model further and decreased that time too 25.932 at rank 115.</p>
<p>I was pretty happy at that point and I‚Äôve left it there, gradually decreasing down to 155 between the time of me returning to my real job and writing this post.</p>
<p><img src="https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+13.28.03.png" alt=""></p>
<p>Ultimately, for me, the whole process of creating code, testing it, reiterating it and then finally succeeding at a goal was great. As developers, we are often doing the same project month after month, not really moving between extremely different technologies and generally staying within the same lane that we started on.</p>
<p>For me, side-projects like creating a DeepRacer model over the weekend is a lot of fun, and although all¬† I really did was spend $70 on a simulation of a race for the achievement of a virtual score within a virtual league, I think I learned a lot from doing it.</p>
<h2>And that‚Äôs it</h2>
<p>Time to get testing!</p>
<p><img src="https://media.giphy.com/media/6mGzvKGJGsYH6/giphy.gif" alt=""></p>
</div></div></div></div> <link rel="stylesheet" href="/css/dracula.min.css"> <script>
  window.onload = function() {
    if (&quot;serviceWorker&quot; in navigator) {
      const offlineButton = document.createElement(&quot;button&quot;);

      offlineButton.className = &quot;button&quot;;

      caches.open(&quot;SavedPages&quot;).then(function(cache) {
        cache.match(window.location.href).then(function(result) {
          if (result) {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText =
              &quot;This page is ready for offline reading üëçüèª&quot;;
            offlineButton.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          } else {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText = &quot;Save this page for offline reading&quot;;
          }
        });
      });

      caches.open(&quot;cachedPages&quot;).then(function(cache) {
        cache.match(window.location.href).then(function(result) {
          if (result) {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText =
              &quot;This page is ready for offline reading üëçüèª&quot;;
            offlineButton.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          } else {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText = &quot;Save this page&quot;;
          }
        });
      });

      offlineButton.addEventListener(&quot;click&quot;, function(ev) {
        ev.preventDefault();

        var btn = this;

        btn.innerText = &quot;Saving...&quot;;

        caches.open(&quot;SavedPages&quot;).then(function(cache) {
          cache.add(window.location.href).then(function() {
            const data = {
              title: document.querySelector(&quot;title&quot;).innerText
            };

            localStorage.setItem(window.location.href, JSON.stringify(data));

            btn.innerText = &quot;This page is ready for offline reading üëçüèª&quot;;
            btn.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          });
        });
      });
    }
  };
    </script></div> <div hidden class="cookies js-cookie-message"><div class="cookies__box"><p><strong>
            Another üç™
            notification.
          </strong> <br>Sorry to bug you, I know these are annoying, just letting you know that I
          am
          using cookies on this site to track analytics, annoymously of course.
        </p> <button class="button button--primary">That's fine</button></div></div> <link href="/css/main.15f091f2.css" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> <script>window.Promise||document.write("&lt;script src=&quot;js/es6-promise.min.js&quot; &gt;&lt;/script&gt;"),window.fetch||document.write("&lt;script src=&quot;js/fetch.min.js&quot;&gt;&lt;/script&gt;")</script> <script type="text/javascript">
    window.addEventListener(&quot;DOMContentLoaded&quot;, function (event) {
        // Load the service worker
        if ('serviceWorker' in navigator) {

            navigator.serviceWorker.register('/serviceworker.js', { scope: '/'}) 

            .then( function( registration) {
                console.log(`Service Worker successfully registered for`, registration.scope);
            } )

            .catch( function( error ) {
                console.log(`ServiceWorker not registered: ${error}`);
            } );

            if(navigator.serviceWorker.controller) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.controller.postMessage({'command': 'trimCaches'});
                })
            }
        }
    });
</script> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NK46QBJ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript></div></div></div><script>window.__NUXT__=function(e,t,a,n,s,o,i,r,l,h,c){return{layout:"default",data:[{attributes:{title:s,published:e,description:o,tags:n,thumbnail:t,header:t,ctime:new Date(1558224e6)},content:'<p>Last weekend marked the beginning of Amazon‚Äôs new virtual DeepRacer league, which is basically a race that is conducted within Amazon‚Äôs platform by a bunch of simulated versions of the¬† DeepRacer vehicle.</p>\n<p>Developers battle it out in this league not by their driving skill but by their knowledge of the AWS platform and their ability to effectively create and train a DeepRacer model on AWS‚Äô platform.¬† As you can tell by the title, this was immediately something that I thought I would be interested in, if not at least just for the weekend and I‚Äôd have to say that I definitely had fun doing it.</p>\n<h2>Getting Started</h2>\n<p>The whole process of getting started with AWS DeepRacer and concept of Reinforcement Learning is a slightly scary one at first sight, this is something that you‚Äôve probably never done before and at times, Amazon‚Äôs slightly jarring interface can be a little confusing.</p>\n<p>Thankfully, it isn‚Äôt actually that hard to do. Simply head on over to the <a href="https://console.aws.amazon.com/deepracer/">AWS DeepRacer</a> page in your console and hit the orange ‚ÄòGet Started‚Äô button,¬† that will take you to another page where you need to click another button in order to create the resources required.</p>\n<p><img src="https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+12.28.57.png" alt=""></p>\n<p>There‚Äôs also a link to a document about learning RL on this page that you should definitely check out.</p>\n<p>Once you‚Äôve done all that, you are ready to start making some models and get spending some money and yes, you will have to spend a bit of money, DeepRacer is definitely not for the light of wallet, more on that later.</p>\n<h2>Creating a DeepRacer model</h2>\n<p>So probably the hardest part of this journey with DeepRacer was the creation of RL models for use with the simulation, while the actual creation¬† of the models simply¬† involves some Python code that you can create in pretty much any IDE, getting a model correct can be a lot of trial and error and a lot of the time,¬† you will¬† end up with an error.</p>\n<p>Sadly, a lot of your success will also be linked to the training settings that you select for your DeepRacer model and while you can do¬† a lot with your own code, sometimes you might end up having to scrap all of the training that you have conducted in order to slightly change a¬† setting with a value that is more than likely¬† to be an utter¬† guess.</p>\n<p>Then you‚Äôll likely have to do at least an hour or two of training before you can get racing.</p>\n<p>That said, I¬† can‚Äôt say that I¬† didn‚Äôt find the experience enjoyable, nor that I didn‚Äôt learn anything from, nor that I didn‚Äôt have any fun.</p>\n<p><img src="https://cdn.nicholasgriffin.dev/images/aawsdeeprace.gif" alt=""></p>\n<p>As¬† you can see from the GIF above, there are a lot of options, but it actually isn‚Äôt that hard to get one going fast.</p>\n<p>In total, I created 19 models over the weekend, and each one gradually started to get a little better, somewhat smarter and a lot faster.</p>\n<p>At the start, I decided to use one of Amazon‚Äôs templates to see how everything worked and to get a quick glimpse into what I could expect, so i used the following function, which is designed to train to car to keep within the two borders and hopefully on the center linne.</p>\n<pre><code class="python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reward_function</span><span class="hljs-params">(params)</span>:</span>     \n    <span class="hljs-string">\'\'\'     \n    Example of rewarding the agent to follow center line     \n    \'\'\'</span>          \n    <span class="hljs-comment"># Read input parameters     </span>\n    track_width = params[<span class="hljs-string">\'track_width\'</span>]     \n    distance_from_center = params[<span class="hljs-string">\'distance_from_center\'</span>]          \n    <span class="hljs-comment"># Calculate 3 markers that are at varying distances away from the center line     </span>\n    marker_1 = <span class="hljs-number">0.1</span> * track_width     \n    marker_2 = <span class="hljs-number">0.25</span> * track_width     \n    marker_3 = <span class="hljs-number">0.5</span> * track_width          \n    <span class="hljs-comment"># Give higher reward if the car is closer to center line and vice versa     </span>\n    <span class="hljs-keyword">if</span> distance_from_center &lt;= marker_1:\n    reward = <span class="hljs-number">1.0</span>     \n    <span class="hljs-keyword">elif</span> distance_from_center &lt;= marker_2:\n    reward = <span class="hljs-number">0.5</span>     \n    <span class="hljs-keyword">elif</span> distance_from_center &lt;= marker_3:\n    reward = <span class="hljs-number">0.1</span>     \n    <span class="hljs-keyword">else</span>:         \n    reward = <span class="hljs-number">1e-3</span>  <span class="hljs-comment"># likely crashed/ close to off track          </span>\n    <span class="hljs-keyword">return</span> float(reward)\n</code></pre>\n<p>As you can see it is actually quite simple but involves quite a lot of math. The premise is that the more that your car does what you want it to, the more reward value you provide. if it does something that you don‚Äôt want itt to, you take the reward away.</p>\n<p>So in this example, the car will get the highest reward if it is closer to the center line.</p>\n<p>For this first one, I did only that and then used the default settings.</p>\n<p><img src="https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+13.04.21.png" alt=""></p>\n<p>The great thing about DeepRacer is that you can actually watch a live stream of your model training in the simulation while it is doing so. This means that you can quickly see where you could make optimisations to your model and what optimisations you should probably tone down.</p>\n<p>Should your model look like it‚Äôs not panning out, you can also quickly stoop the training and save some money.</p>\n<p>Once my model had finished, I worked out that although it was occasionally steering to the center for those points, it was not staying there for a long period of time and even sometimes going off the track.</p>\n<p>Thankfully, Amazon has already set up a range of parameters that will allow you to customise your reward function¬† and get the most out of it.</p>\n<pre><code class="python">    {     \n        <span class="hljs-string">"all_wheels_on_track"</span>: Boolean,    \n        <span class="hljs-comment"># flag to indicate if the vehicle is on the track     </span>\n        <span class="hljs-string">"x"</span>: float,                        \n        <span class="hljs-comment"># vehicle\'s x-coordinate in meters     </span>\n        <span class="hljs-string">"y"</span>: float,                        \n        <span class="hljs-comment"># vehicle\'s y-coordinate in meters     </span>\n        <span class="hljs-string">"distance_from_center"</span>: float,     \n        <span class="hljs-comment"># distance in meters from the track center      </span>\n        <span class="hljs-string">"is_left_of_center"</span>: Boolean,      \n        <span class="hljs-comment"># Flag to indicate if the vehicle is on the left side to the track center or not.      </span>\n        <span class="hljs-string">"heading"</span>: float,                  \n        <span class="hljs-comment"># vehicle\'s yaw in degrees     </span>\n        <span class="hljs-string">"progress"</span>: float,                 \n        <span class="hljs-comment"># percentage of track completed     </span>\n        <span class="hljs-string">"steps"</span>: int,                      \n        <span class="hljs-comment"># number steps completed     </span>\n        <span class="hljs-string">"speed"</span>: float,                    \n        <span class="hljs-comment"># vehicle\'s speed in meters per second (m/s)     </span>\n        <span class="hljs-string">"steering_angle"</span>: float,          \n        <span class="hljs-comment"># vehicle\'s steering angle in degrees     </span>\n        <span class="hljs-string">"track_width"</span>: float,              \n        <span class="hljs-comment"># width of the track     </span>\n        <span class="hljs-string">"waypoints"</span>: [[float, float], ‚Ä¶ ], \n        <span class="hljs-comment"># list of [x,y] as milestones along the track center     </span>\n        <span class="hljs-string">"closest_waypoints"</span>: [int, int]    \n        <span class="hljs-comment"># indices of the two nearest waypoints. </span>\n    }\n</code></pre>\n<p>So what I did was combine the default with a multiplier for the car‚Äôs progress while being in the center of the track.</p>\n<pre><code class="python">     Give higher reward <span class="hljs-keyword">if</span> the car <span class="hljs-keyword">is</span> closer to center line <span class="hljs-keyword">and</span> vice versa     \n     <span class="hljs-keyword">if</span> distance_from_center &lt;= marker_1:         \n        reward = <span class="hljs-number">1.0</span> * progress     \n     <span class="hljs-keyword">elif</span> distance_from_center &lt;= marker_2:         \n        reward = <span class="hljs-number">0.5</span>     \n    <span class="hljs-keyword">elif</span> distance_from_center &lt;= marker_3:         \n        reward = <span class="hljs-number">0.1</span>     \n    <span class="hljs-keyword">else</span>:         \n        reward = <span class="hljs-number">1e-3</span>  <span class="hljs-comment"># likely crashed/ close to off track</span>\n</code></pre>\n<p>I also wanted it to go faster, while not steering to much so I added the following:</p>\n<pre><code class="python">        <span class="hljs-comment"># Add penalty if throttle exsides the steering else add reward     </span>\n        <span class="hljs-keyword">if</span> abs(steering_angle) &gt; <span class="hljs-number">15</span> <span class="hljs-keyword">and</span> abs(steering_angle &gt; throttle):         \n            reward *= <span class="hljs-number">1</span> - (steering_angle - throttle)     \n        <span class="hljs-keyword">else</span>:         \n            reward *= <span class="hljs-number">1</span> + throttle\n</code></pre>\n<p>And then I had to increase the speed on the action parameters as well, this is the part where you have more risk in changing your parameters, as you can‚Äôt change the parameters on a cloned model, only a new one and once you create a new model, you lose all of your progress and training, but keeping the defaults will definitely mean that you will not be able to progress through the league as much.</p>\n<p>You can also play around with the HyperParameters to optimise your training, however, this is again a bit of trail and error.</p>\n<p>For me, once I did that, I was able to get a good training session from my model and finally submitted my first decent score of 28:350 o the London Loop, which at the time put me at rank 145.</p>\n<p>I then trained the model further and decreased that time too 25.932 at rank 115.</p>\n<p>I was pretty happy at that point and I‚Äôve left it there, gradually decreasing down to 155 between the time of me returning to my real job and writing this post.</p>\n<p><img src="https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+13.28.03.png" alt=""></p>\n<p>Ultimately, for me, the whole process of creating code, testing it, reiterating it and then finally succeeding at a goal was great. As developers, we are often doing the same project month after month, not really moving between extremely different technologies and generally staying within the same lane that we started on.</p>\n<p>For me, side-projects like creating a DeepRacer model over the weekend is a lot of fun, and although all¬† I really did was spend $70 on a simulation of a race for the achievement of a virtual score within a virtual league, I think I learned a lot from doing it.</p>\n<h2>And that‚Äôs it</h2>\n<p>Time to get testing!</p>\n<p><img src="https://media.giphy.com/media/6mGzvKGJGsYH6/giphy.gif" alt=""></p>\n'}],error:null,state:{bloglist:[{title:"Using Sentiment Analysis to test user interaction",published:e,description:"Using AWS Comprehend to perform Sentiment Analysis on comments.",tags:"javascript,AWS, AWS Comprehend, Machine Learning",thumbnail:a,header:a,ctime:"2019-05-20",slug:"5ce1f1631c9d440000cbc59c"},{title:s,published:e,description:o,tags:n,thumbnail:t,header:t,ctime:i,slug:"5ce13a901c9d4400004275bd"},{title:"Adding Service Worker to my site",published:e,description:"Whoops! I forgot to add Service Worker to my site. Probably about time to do that...",tags:"javascript,service worker",thumbnail:r,header:r,ctime:i,slug:"5ce1adde1c9d4400007337c6"},{title:"Adding authentication to our Express blog with Passport.js",published:e,description:"Time to make things secure",tags:"javascript,Node, Express, Passport.js,authentication",thumbnail:l,header:l,ctime:"2019-04-19",slug:"5c7c00ffa1e5fbe51cd94951"},{title:"How I built a blog with Node, Express and Mongo",published:e,description:"Let's get blogging!",tags:"javascript,Express,Node,Mongo",thumbnail:h,header:h,ctime:"2019-04-02",slug:"5c7be6e2a1e5fbe51cd94950"},{title:"Let's begin again...",published:e,description:"Nicholas Griffin V.Something",tags:"Meta",thumbnail:c,header:c,ctime:"2019-04-01",slug:"5c7af91ae6bdacc5ee62ecfe"}]},serverRendered:e}}(!0,"https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+12.19.03.png","https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-20+at+01.08.17.png","javascript,AWS, AWS DeepRacer, Machine Learning","My weekend with AWS DeepRacer","Here are the results of my weekend playing around with AWS DeepRacer","2019-05-19","https://cdn.nicholasgriffin.dev/images/Screenshot+2019-05-19+at+20.24.38.png","https://nicholasgriffin.dev/uploads/bp/2019/March/users_js.jpg","https://nicholasgriffin.dev/uploads/bp/2019/March/postman_addpost_2019.jpg","https://i.ibb.co/g6MPvkg/Screenshot-2019-03-02-at-21-45-38.jpg")</script><script src="/_nuxt/08095cc0ddcff0005f18.js" defer></script><script src="/_nuxt/0a9df1c9c77a89bdd93f.js" defer></script><script src="/_nuxt/d7c75f6ac79d1786d22d.js" defer></script><script src="/_nuxt/cd4412461eab3e0f1742.js" defer></script><script src="/_nuxt/72ff58b2c4c4555793ba.js" defer></script>
  </body>
</html>
