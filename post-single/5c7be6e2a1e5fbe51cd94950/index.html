<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="lang">
  <head data-n-head="">
    <title data-n-head="true">How I built a blog with Node, Express and Mongo | Nicholas Griffin</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width, initial-scale=1"><meta data-n-head="true" data-hid="keywords" name="keywords" content="web developer,blogger,technology,founder,TechNutty"><meta data-n-head="true" data-hid="author" name="author" content="Nicholas Griffin"><meta data-n-head="true" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="true" data-hid="apple-mobile-web-app-title" name="apple-mobile-web-app-title" content="nicholasgriffin"><meta data-n-head="true" data-hid="theme-color" name="theme-color" content="#fff"><meta data-n-head="true" data-hid="og:type" name="og:type" property="og:type" content="website"><meta data-n-head="true" data-hid="og:title" name="og:title" property="og:title" content="nicholasgriffin"><meta data-n-head="true" data-hid="og:site_name" name="og:site_name" property="og:site_name" content="nicholasgriffin"><meta data-n-head="true" data-hid="og:description" name="og:description" property="og:description" content="My personal website"><meta data-n-head="true" data-hid="description" name="description" content="Let&#x27;s get blogging!"><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-57x57.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-60x60.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-72x72.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-76x76.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-114x114.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-120x120.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-144x144.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/apple-touch-icon-180x180.png"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-32x32.png" sizes="32x32"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/android-chrome-192x192.png" sizes="192x192"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-96x96.png" sizes="96x96"><link data-n-head="true" rel="icon" type="apple-touch-icon" href="/icons/favicon-16x16.png" sizes="16x16"><link data-n-head="true" rel="mask-icon" type="apple-touch-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5"><link data-n-head="true" name="apple-mobile-web-app-title" content="Nicholas Griffin"><link data-n-head="true" name="application-name" content="Nicholas Griffin"><link data-n-head="true" name="theme-color" content="#5bbad5"><link data-n-head="true" rel="manifest" href="/manifest.json"><link data-n-head="true" rel="shortcut icon" href="/_nuxt/icons/icon_64.8AAfD9L2mjc.png"><link data-n-head="true" rel="apple-touch-icon" href="/_nuxt/icons/icon_512.8AAfD9L2mjc.png" sizes="512x512"><link rel="preload" href="/_nuxt/335238b4871730cf9f7d.js" as="script"><link rel="preload" href="/_nuxt/d26db56abffc2e10e685.js" as="script"><link rel="preload" href="/_nuxt/ed5ca3c40fa941f82244.js" as="script"><link rel="preload" href="/_nuxt/8c50d3902d6da8d5999e.js" as="script"><link rel="preload" href="/_nuxt/ad3882a62a81c04ccdbd.js" as="script"><style data-vue-ssr-id="17cfdfa9:0 aab9a468:0 9a8fa946:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#fff;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}
body,div#root{overflow-x:hidden}body,html{margin:0;padding:0;border:0;outline:0;vertical-align:baseline;background:0 0}.single-page .mid-box-background{padding-top:2rem;padding-bottom:2rem}.App{text-align:center}.App-header{position:fixed;top:0;left:0;width:100%;height:70vh;background-color:#222;padding:20vh 20px 20px;padding-left:0!important;color:#fff}.background-colours{opacity:.1}.background{position:absolute;top:0;right:0;bottom:0;left:0;background:#093054;background:-webkit-gradient(left top,right bottom,color-stop(0,#093054),color-stop(100%,#0b1042));background:linear-gradient(135deg,#093054,#0b1042);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#093054",endColorstr="#0b1042",GradientType=1)}.title-wrapper h1{font-size:3.1em!important;line-height:1.4;font-weight:700;color:#fff}.App-content{min-height:100vh;width:100vw;position:relative;background:#fff;z-index:9}.lazy{opacity:1;transition:opacity .3s}.lazy[data-src]{opacity:0}#OpeningContentWrapper img{max-height:80px;height:120px;margin-bottom:20px;margin-top:20px;width:auto}#BlogPostOpenerWrapper{display:inline-block;padding-top:40px;padding-bottom:40px;margin-top:20px;width:100%;color:#fff}#OpeningContentSocial a{text-decoration:none}#default-typed-strings,#second-typed-strings-delay,#third-typed-strings-delay,#typed-strings,#typed-strings-delay,.scroll-down{display:none}#OpeningContentWrapper p,#welcometomysite,.homepage-subtitle{display:inline-block}.homepage-subtitle #typed,.typed-cursor{font-size:1.5em!important}.typed-cursor{margin-left:10px}@media only screen and (min-width:992px){#OpeningContentWrapper{padding-top:0;padding-right:120px}#welcometomysite{margin-left:.25em}#MusicOpeningWrapper,div#OpeningContentWrapperWrap{padding-left:0!important;padding-right:0!important}}#welcometomysite{font-size:2.5em}.post-img{width:100%;height:auto;max-height:200px}.homepage-subtitle{width:calc(100% - 20px);overflow:hidden;text-overflow:ellipsis;margin-left:10px;margin-right:10px}#BlogandMoreAboutSeconndWrapper .card{overflow:hidden}#BlogandMoreAboutSeconndWrapper .card .image{margin-left:-1rem;margin-right:-1rem;margin-top:-1rem}.post-button.ui.bottom.button{margin-left:-1em;margin-top:-.75em;margin-bottom:-1em;border-radius:0;padding-bottom:1em;background:#19034e;color:#fff;width:calc(100% - 1em)}#TwitterLinkWrap,.social-icon{margin-left:10px;margin-right:10px;display:inline-block}.social-icon{max-width:40px}#cookie-law{position:fixed;bottom:10px;right:10px;width:100%;max-width:320px;background:#f6f6f6;border:1px solid #333;z-index:999;padding:5px}#blogLoadMoreButton{margin-top:20px;background:#ddd;color:#000}div#customSpotifyRight{height:300px}div#customSpotifyRightElementSongWrapper{height:100%;position:relative}div#customSpotifyRightElementSongContainer{height:100%;background-size:cover}div#customSpotifyRightElementSongOverlay{position:absolute;top:0;left:0;background:0 0;width:100%;height:100%;color:#fff}div#nowPlayingOverlay{position:absolute;right:0;top:0;background:#0b0444;padding:10px}#customSpotifyLeft,#customSpotifyRight,.leftSideSong div,a.trackLinkFloat{padding:0!important}div#customSpotifyRightElementSongOverlayContent{margin-top:100px}.trackLinkPlay svg{max-width:50px;fill:#fff;margin-top:10px}.trackLinkPlay svg path{fill:#fff}div#customSpotifyRightElementSongOverlayContent span,div#spotifyOpenerWrapper{display:inline-block;width:100%}div#spotifyOpenerWrapper{margin-top:50px;border-top:1px solid #ddd;border-bottom:1px solid}.leftSideSong{background:#000;color:#fff;position:relative}a.trackLinkFloat{position:absolute;top:0;left:0;width:100%;height:100%;margin:0!important;z-index:999}div#customSpotifyLeftElementSongWrapper{margin-top:15px;background:#000}.leftSideSong,div#spotify-widget{margin-left:0!important;margin-right:0!important}#spotify-widget{margin-top:20px!important}.leftSideSong.ui.grid{border-bottom:1px solid;padding-bottom:5px;padding-top:5px}.leftSideSong h3{margin-top:0;margin-bottom:0;font-size:1em}.leftSideSong span{margin-right:5px;font-size:.8em}div#customSpotifyLeft{max-height:150px;overflow-y:scroll;overflow-x:hidden}div#mainOpeningContentWrap{margin:10vh 0 0;display:flex}div#OpeningContentWrapper{text-align:left}@media only screen and (min-width:992px){#OpeningContentWrapper p img{max-height:2.5em;height:auto;margin-bottom:0;margin-top:0;width:auto}}@media only screen and (max-width:992px){#OpeningContentWrapper p img{max-height:5em;height:auto;margin-bottom:0;margin-top:0;width:auto}h2#welcometomysite{width:100%}}span#MusicOpeningWrapperTitle{display:inline-block;width:100%;margin-top:20px}div#spotify-widget{height:450px}.social-icon-wrap{font-size:2.4em;color:#000}#TwitterLinkWrap{color:#1da1f2}a#LinkedinLinkWrap{color:#0077b5}.coloured-container{background:#19034e;padding-bottom:250px;margin-top:100px}.coloured-float-container{margin-top:-250px;margin-bottom:100px}#ExtraContentWrapper{margin-top:150px;margin-bottom:150px}#SkillsContentContainer{margin-top:50px}.column.icon-grid-item{padding:0!important;text-align:center}.icon-grid-item img{max-width:50px!important}.icon-grid-item span{width:100%;display:inline-block;margin-top:10px}#SkillsContentContainer h3{margin-bottom:50px;margin-top:50px;display:inline-block;width:100%}.cookies.js-cookie-message{position:fixed;bottom:20px;right:0;max-width:320px;width:100%;z-index:9999;background:#fff;border-radius:4px;padding:1rem;border:1px solid #ddd;box-shadow:0 0 10px 0 rgba(0,0,0,.1)}.cookies__box button{width:100%;padding:.5rem;background:0;border-color:#171f32;color:#171f32;font-weight:600;border-radius:4px}body{margin:0;padding:0;font-family:sans-serif}header{background:#000;width:calc(100% - 2rem);padding:1rem}.text-normal{text-align:left;text-align:initial}header .site-title-header{display:inline-block;width:auto;font-size:1.5rem;color:#a3a7ae;font-weight:600}header .site-title-header a{text-decoration:none;color:#a3a7ae}header .site-links-header{display:inline-block;float:right}header .site-links-header a{color:#485569;text-transform:uppercase;text-decoration:none;font-size:1rem;padding:.25rem;display:inline-block}header a:hover{color:#fff!important}.ui.container{display:block;max-width:100%!important}@media only screen and (max-width:767px){.ui.container,.ui.grid.container,.ui.relaxed.grid.container,.ui.very.relaxed.grid.container{width:auto!important}.ui.container{margin-left:1em!important;margin-right:1em!important}}@media only screen and (min-width:768px) and (max-width:991px){.ui.container{width:723px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(723px + 2rem)!important}.ui.relaxed.grid.container{width:calc(723px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(723px + 5rem)!important}}@media only screen and (min-width:992px) and (max-width:1199px){.ui.container{width:933px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(933px + 2rem)!important}.ui.relaxed.grid.container{width:calc(933px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(933px + 5rem)!important}}@media only screen and (min-width:1200px){.ui.container{width:1127px;margin-left:auto!important;margin-right:auto!important}.ui.grid.container{width:calc(1127px + 2rem)!important}.ui.relaxed.grid.container{width:calc(1127px + 3rem)!important}.ui.very.relaxed.grid.container{width:calc(1127px + 5rem)!important}}#BlogContentContainer .card .image{max-height:220px;overflow:hidden}.repo-language-color{border-radius:50%;display:inline-block;height:12px;position:relative;top:1px;width:12px;background-color:#19034e}#githubReposContainer{margin:0;padding-top:1rem}.PHP .repo-language-color{background-color:#777bb4}.HTML .repo-language-color{background-color:#e34f25}.CSS .repo-language-color{background-color:#1372b6}.JavaScript .repo-language-color{background-color:#f7df1c}.repo-language-color{margin-right:5px!important}.card .content a.header{text-decoration:none;margin-bottom:5px}pre{background:#272727;color:#fff;padding:20px;white-space:pre-wrap;font-size:16px;font-family:Menlo,Monaco,Courier New,Courier,monospace;overflow:auto}.post-content-sidebar{max-width:320px}.App-content{top:0!important;margin-top:90vh}.single-page .App-content{top:0!important;margin-top:0!important}.social-icon-wrap svg{width:32px;height:auto}#TwitterLinkWrap svg,#TwitterLinkWrap svg path{fill:#1da1f2!important}#LinkedinLinkWrap svg,#LinkedinLinkWrap svg path{fill:#0077b5}.social-icon-wrap:hover svg{opacity:.6}@media only screen and (max-width:768px){.App-header.full-height-header{height:100%;padding-top:20px}}#MusicOpeningWrapperTitle svg{width:14px;display:inline-block;-webkit-transform:rotate(180deg);transform:rotate(180deg)}img.lazy.loaded{opacity:1!important}.alert.alert-danger{color:#d22d2d}.alert{width:100%;margin-bottom:20px;text-align:left}.button-block{display:block;width:100%}.button{border:0;outline:none;border-radius:0;padding:15px 0;font-size:22px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;background:transparent;color:#fff;transition:all .5s ease;-webkit-appearance:none}.header-single-image-full img{width:100%;height:auto;top:50%;transition:translateY(-50%);position:relative}.post-header-titles{max-width:780px;margin:-70px auto auto;background:#fff;z-index:99;position:relative;padding:1rem}.header-single-image-full{max-height:500px;overflow:hidden;width:100%;height:auto;vertical-align:middle;display:block}
.single-page .App-header{height:auto!important;padding-top:0!important;position:relative}.single-page .App-content{top:0!important;padding:1rem;text-align:left;min-height:150px;width:calc(100% - 2rem)}img.post-image{width:100%;height:auto}.post-content-wrap{max-width:780px;width:calc(100% - 2rem);margin:auto;padding:1rem}.post-buttons-wrapper .button{background:#000;font-size:.7rem;opacity:1;border-radius:4px;padding:1rem;cursor:pointer}.post-buttons-wrapper{margin-top:.5rem}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><script type="text/javascript" async="async" src="https://www.google-analytics.com/analytics.js"></script> <script async="async" src="https://www.googletagmanager.com/gtm.js?id=GTM-NK46QBJ"></script> <script>
  (function(w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
      &quot;gtm.start&quot;: new Date().getTime(),
      event: &quot;gtm.js&quot;
    });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != &quot;dataLayer&quot; ? &quot;&amp;l=&quot; + l : &quot;&quot;;
    j.async = true;
    j.src = &quot;https://www.googletagmanager.com/gtm.js?id=&quot; + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, &quot;script&quot;, &quot;dataLayer&quot;, &quot;GTM-NK46QBJ&quot;);
    </script> <header><div class="ui container text-normal"><span class="site-title-header"><a href="https://nicholasgriffin.dev">
            Nicholas Griffin
        </a></span> <div class="site-links-header"><a href="https://nicholasgriffin.dev">
                Home
            </a></div></div></header> <div><div class="single-page"><div class="header-single-image-full"><img src="https://nicholasgriffin.dev/uploads/bp/2019/March/postman_addpost_2019.jpg" alt="How I built a blog with Node, Express and Mongo" loading="lazy"></div> <div class="App-content"><div class="ui container"><div class="post-header"><div class="post-header-titles"><h1 id="single-title" class="animated bounceInDown">How I built a blog with Node, Express and Mongo</h1> <h2><div class="post-buttons-wrapper"></div></h2></div></div> <div class="post-content-wrap"><p>So with the move to my new server, I had to create something that would allow me to create a set blog post like the one you are reading now. One of my aims for 2019 and onwards¬†is to do more development and projects that don‚Äôt really have any aim, simply to learn new stuff.</p>
<p>To kick that off, I needed some kind of platform that would allow me to submit posts to my site, over an authenticated user but without using any kind¬†of third party, as I want my new site to depend on fewer third-parties and the whole aim of this project is to do more for myself.</p>
<p>So I got to work on a new platform that uses the Express basis that I previously created alongside Mongo for storing the posts and Passport.js for the JWT authentication on the APIs that I would be creating. For now the blog platform is all API based, however, I will be expanding this with a full login and dashboard system¬†soon.</p>
<h2>Let‚Äôs get started</h2>
<p>Before you can begin this for yourself, you will need to create a starter Node application¬†with Express installed, there are numerous¬†tutorials around the web for doing this and the platform changes regularly so it might be best to do some <a href="https://www.google.com/search?q=node+express+starter" title="Google Node Express Starter">Googling</a> for that part.</p>
<p>Once you have a Node app ready, you will need to get a Mongo server setup and you will need to install the¬†Mongoose¬†package within your Node application.</p>
<p>On a mac, you can install a Mongo server with the following command:</p>
<pre class="graf graf--pre graf-after--p" id="90bc">brew install mongo  
mkdir -p /data/db  
sudo chown -R `id -un` /data/db</pre>
<p>Once complete, simply run¬†mongod to startup your Mongo DB on localhost. For a server, you may want to look into something different. Personally, I quite like the <a href="https://www.mongodb.com/cloud">MongoDB Cloud service</a> for development.</p>
<p>And for the Mongoose¬†install, run the following within your Node terminal¬†(you may have to open a new window).</p>
<pre class="graf graf--pre graf-after--p" id="e0a2">npm install mongoose --save</pre>
<p>Then in your main app.js file add the following to start the mongodb server:</p>
<pre class="graf graf--pre graf-after--p" id="4cfa">var mongoose = require('mongoose')  
mongoose.connect("mongodb://localhost:27017/my-blog")</pre>
<p>You may need to change¬†localhost to your domain if you are using something else, alongside¬†the ending database name. I‚Äôve set it as my-blog for now for this post.</p>
<p><strong>Setting up body parser</strong></p>
<p>While we are entering commands, it would be a good¬†idea to install body parser from NPM. This module works great for parsing data that has been passed to your application, we will be using it to parse the data that is passed to the POST API that we will be setting up later.</p>
<p>To get started with body parser, run the following command in your Terminal window:</p>
<pre class="graf graf--pre graf-after--p" id="b26d">npm install body-parser</pre>
<p>Then include the following within your main application file:</p>
<pre class="graf graf--pre graf-after--p" id="ec95">var bodyParser = require('body-parser')  
app.use(bodyParser.json())  
app.use(bodyParser.urlencoded({ extended: true}))</pre>
<p><strong>Setting up the Mongo schema</strong></p>
<p>We are almost done but before we can start sending blog post data we will need to set up our Mongo database table and the schema that will be linked to that table.</p>
<p>To do that, you will need to add the following to your main application file:</p>
<pre class="graf graf--pre graf-after--p" id="24c3">var postSchema = new mongoose.Schema({ posttype: String, title: String, date: String, image: String, excerpt: String, body:  String });</pre>
<pre class="graf graf--pre graf-after--pre" id="9285">var Post = mongoose.model('Post', postSchema);</pre>
<p>I‚Äôve added a few items to the schema here, but basically, you just need to set what your mongo will accept and the type that it should expect. You can <a href="https://mongoosejs.com/docs/guide.html">find out more about Mongoose schemas here</a>.</p>
<p><strong>Setting up your API for adding new posts</strong></p>
<p>For this first part, we will be setting up a simplistic¬†API for adding new posts, however, I am aiming to release another blog post soon with more about authenticating APIs with Passport.js. I didn‚Äôt want to fill this one with too much just yet.</p>
<p>Anyway, to set up your new API you will need to include the following within your application file:</p>
<pre class="graf graf--pre graf-after--p" id="8df2">app.post('/launchpost', (req, res) => {  
    var postData = new Post(req.body);  
    postData.save().then( result => {  
        res.redirect('/');  
    }).catch(err => {  
        res.status(400).send("Unable to save data");  
    });  
});</pre>
<p>This is a pretty simplistic listener that will link to any post request sent to the ‚Äò/launchpost‚Äô path on your domain, you can change this to whatever you like as the name doesn‚Äôt really matter.</p>
<p>When someone sends a post request to this path it will grab the data from the body, save it in your configured Mongo table and then redirect the user to the homepage.</p>
<p>If you‚Äôd prefer to not have the redirect, you could change that line to the following:</p>
<pre class="graf graf--pre graf-after--p" id="8df2">res.status(200).send("Post saved.");</pre>
<p>It will then simply send back a message that says ‚ÄòPost saved‚Äô, you could also expand this to send back the generated post ID.</p>
<p>You can query this API with Postman like this:</p>
<p><img src="/uploads/bp/2019/March/postman_addpost_2019.jpg" alt=""></p>
<p><strong>Setting up your API for removing posts</strong></p>
<p>Sometimes you might want to remove a post that you have previously added so it might also make sense to create an API that will allow you to easily remove posts that you have previously published. You can do that with the following:</p>
<pre class="graf graf--pre graf-after--p" id="8df2">app.post('/removepost', (req, res) => {  
    var postData = new Post({_id: req.body.id});  
    postData.remove().then( result => {  
        res.redirect('/');  
    }).catch(err => {  
        res.status(400).send("Unable to remove data");  
    });  
});</pre>
<p>Again, feel free to change the name of the post or how it responds.</p>
<p>And querying it in Postman will look like this:</p>
<p><img src="/uploads/bp/2019/March/postman_removepost_2019.jpg" alt=""></p>
<p><strong>Displaying your blog post</strong></p>
<p>Now that you have your APIs ready, you should probably set up a page to do this.</p>
<p>Personally, I quite like how the EJS templating engine works, so we will be using that to build the templates and then ultimately show the posts.</p>
<p>You can install EJS via your terminal window with the following command:</p>
<pre class="graf graf--pre graf-after--p" id="e345">npm install ejs --save</pre>
<p>You will then need to add the following to your application so that Express will use the engine:</p>
<pre class="graf graf--pre graf-after--p" id="62ae">app.engine('html', require('ejs').renderFile);  
app.set('view engine', 'html');</pre>
<p>By default, EJS will look for template files in a directory named ‚Äòviews‚Äô so you will need to create that and then add an index.html file within that directory.</p>
<p>There‚Äôs a lot you can do with EJS in terms of templates, however, for this tutorial we are going to keep things simple, so within this html file we will simply be adding the code to display our posts, feel free to take at look at the EJS documentation to learn more about how to use it.</p>
<p>But before then, be sure to include the following code within your index.html file for the displaying of blog posts:</p>
<pre style="margin: 0; line-height: 125%">    <% <span style="color: #0000aa">if</span>(posts){ %>     <% <span style="color: #0000aa">for</span>(let i = <span style="color: #009999">0</span>; i < posts.length; i++) { %>     <div class=<span style="color: #aa5500">"card"</span>>         <div class=<span style="color: #aa5500">"image"</span>>         <img src=<span style="color: #aa5500">"<%= posts[i].image %>"</span>>         </div>         <div class=<span style="color: #aa5500">"content"</span>>         <a class=<span style="color: #aa5500">"header"</span>><%= posts[i].title %></a>         <div class=<span style="color: #aa5500">"meta"</span>>             <span class=<span style="color: #aa5500">"date"</span>><%= posts[i].date %></span>         </div>         <div class=<span style="color: #aa5500">"description"</span>>             <%= posts[i].excerpt %>         </div>         </div>         <div class=<span style="color: #aa5500">"extra content"</span>>         <a class=<span style="color: #aa5500">"ui button primary basic inverted"</span> href=<span style="color: #aa5500">"/post-single?postID=<%= posts[i]._id %>"</span>>             Read more         </a>         </div>     </div>     <% } %> <% } %> </pre>
<p>Finally, you‚Äôll need to add the route for your homepage like the following:</p>
<pre style="margin: 0; line-height: 125%">app.get(<span style="color: #aa5500">"/"</span>, (req, res) => {    Post.find({}, (err, posts) => {       res.render(<span style="color: #aa5500">'index'</span>, { posts: posts})    }); }); </pre>
<p>And for our single page route (you‚Äôll need create a page for this like the homepage):</p>
<pre style="margin: 0; line-height: 125%">app.get(<span style="color: #aa5500">"/post-single"</span>, (req, res) => {     Post.find({ <span style="color: #aa5500">'_id'</span>: req.query.postID }, (err, posts) => {        res.render(<span style="color: #aa5500">'post-single'</span>, { posts: posts})     }).sort({date: <span style="color: #aa5500">'descending'</span>}); }); </pre>
<h2>And now you are ready to go!</h2>
<p><img src="https://media.giphy.com/media/s2qXK8wAvkHTO/giphy.gif" alt=""></p>
<p>You are ready to get blogging. Of course, you will probably want to authenticate this and you probably don‚Äôt want to be adding post via Postman‚Ä¶ Stay tuned for when I remember to talk about doing that‚Ä¶</p>
</div></div></div></div> <link rel="stylesheet" href="/css/dracula.min.css"> <script>
  window.onload = function() {
    if (&quot;serviceWorker&quot; in navigator) {
      const offlineButton = document.createElement(&quot;button&quot;);

      offlineButton.className = &quot;button&quot;;

      caches.open(&quot;SavedPages&quot;).then(function(cache) {
        cache.match(window.location.href).then(function(result) {
          if (result) {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText =
              &quot;This page is ready for offline reading üëçüèª&quot;;
            offlineButton.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          } else {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText = &quot;Save this page for offline reading&quot;;
          }
        });
      });

      caches.open(&quot;cachedPages&quot;).then(function(cache) {
        cache.match(window.location.href).then(function(result) {
          if (result) {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText =
              &quot;This page is ready for offline reading üëçüèª&quot;;
            offlineButton.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          } else {
            document
              .querySelector(&quot;.post-buttons-wrapper&quot;)
              .appendChild(offlineButton);
            offlineButton.innerText = &quot;Save this page&quot;;
          }
        });
      });

      offlineButton.addEventListener(&quot;click&quot;, function(ev) {
        ev.preventDefault();

        var btn = this;

        btn.innerText = &quot;Saving...&quot;;

        caches.open(&quot;SavedPages&quot;).then(function(cache) {
          cache.add(window.location.href).then(function() {
            const data = {
              title: document.querySelector(&quot;title&quot;).innerText
            };

            localStorage.setItem(window.location.href, JSON.stringify(data));

            btn.innerText = &quot;This page is ready for offline reading üëçüèª&quot;;
            btn.setAttribute(&quot;disabled&quot;, &quot;disabled&quot;);
          });
        });
      });
    }
  };
    </script></div> <div hidden="hidden" class="cookies js-cookie-message"><div class="cookies__box"><p><strong>
            Another üç™
            notification.
          </strong> <br>Sorry to bug you, I know these are annoying, just letting you know that I
          am
          using cookies on this site to track analytics, annoymously of course.
        </p> <button class="button button--primary">That's fine</button></div></div> <link href="/css/main.15f091f2.css" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> <script>
    // Check for Promises and fetch
    window.Promise || document.write('&lt;script src=&quot;js/es6-promise.min.js&quot; &gt;&lt;\/script&gt;');
    window.fetch || document.write('&lt;script src=&quot;js/fetch.min.js&quot;&gt;&lt;\/script&gt;');
</script> <script type="text/javascript">
    window.addEventListener(&quot;DOMContentLoaded&quot;, function (event) {
        // Load the service worker
        if ('serviceWorker' in navigator) {

            navigator.serviceWorker.register('/serviceworker.js', { scope: '/'}) 

            .then( function( registration) {
                console.log(`Service Worker successfully registered for`, registration.scope);
            } )

            .catch( function( error ) {
                console.log(`ServiceWorker not registered: ${error}`);
            } );

            if(navigator.serviceWorker.controller) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.controller.postMessage({'command': 'trimCaches'});
                })
            }
        }
    });
</script> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NK46QBJ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript></div></div></div><script>window.__NUXT__=(function(a,b,c,d,e,f,g,h,i,j,k){return {layout:"default",data:[{attributes:{title:e,published:a,description:f,tags:d,thumbnail:b,header:b,ctime:new Date(1554163200000)},content:"\u003Cp\u003ESo with the move to my new server, I had to create something that would allow me to create a set blog post like the one you are reading now. One of my aims for 2019 and onwards¬†is to do more development and projects that don‚Äôt really have any aim, simply to learn new stuff.\u003C\u002Fp\u003E\n\u003Cp\u003ETo kick that off, I needed some kind of platform that would allow me to submit posts to my site, over an authenticated user but without using any kind¬†of third party, as I want my new site to depend on fewer third-parties and the whole aim of this project is to do more for myself.\u003C\u002Fp\u003E\n\u003Cp\u003ESo I got to work on a new platform that uses the Express basis that I previously created alongside Mongo for storing the posts and Passport.js for the JWT authentication on the APIs that I would be creating. For now the blog platform is all API based, however, I will be expanding this with a full login and dashboard system¬†soon.\u003C\u002Fp\u003E\n\u003Ch2\u003ELet‚Äôs get started\u003C\u002Fh2\u003E\n\u003Cp\u003EBefore you can begin this for yourself, you will need to create a starter Node application¬†with Express installed, there are numerous¬†tutorials around the web for doing this and the platform changes regularly so it might be best to do some \u003Ca href=\"https:\u002F\u002Fwww.google.com\u002Fsearch?q=node+express+starter\" title=\"Google Node Express Starter\"\u003EGoogling\u003C\u002Fa\u003E for that part.\u003C\u002Fp\u003E\n\u003Cp\u003EOnce you have a Node app ready, you will need to get a Mongo server setup and you will need to install the¬†Mongoose¬†package within your Node application.\u003C\u002Fp\u003E\n\u003Cp\u003EOn a mac, you can install a Mongo server with the following command:\u003C\u002Fp\u003E\n\u003Cpre class=\"graf graf--pre graf-after--p\" id=\"90bc\"\u003Ebrew install mongo  \nmkdir -p \u002Fdata\u002Fdb  \nsudo chown -R `id -un` \u002Fdata\u002Fdb\u003C\u002Fpre\u003E\n\u003Cp\u003EOnce complete, simply run¬†mongod to startup your Mongo DB on localhost. For a server, you may want to look into something different. Personally, I quite like the \u003Ca href=\"https:\u002F\u002Fwww.mongodb.com\u002Fcloud\"\u003EMongoDB Cloud service\u003C\u002Fa\u003E for development.\u003C\u002Fp\u003E\n\u003Cp\u003EAnd for the Mongoose¬†install, run the following within your Node terminal¬†(you may have to open a new window).\u003C\u002Fp\u003E\n\u003Cpre class=\"graf graf--pre graf-after--p\" id=\"e0a2\"\u003Enpm install mongoose --save\u003C\u002Fpre\u003E\n\u003Cp\u003EThen in your main app.js file add the following to start the mongodb server:\u003C\u002Fp\u003E\n\u003Cpre class=\"graf graf--pre graf-after--p\" id=\"4cfa\"\u003Evar mongoose = require('mongoose')  \nmongoose.connect(\"mongodb:\u002F\u002Flocalhost:27017\u002Fmy-blog\")\u003C\u002Fpre\u003E\n\u003Cp\u003EYou may need to change¬†localhost to your domain if you are using something else, alongside¬†the ending database name. I‚Äôve set it as my-blog for now for this post.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003ESetting up body parser\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EWhile we are entering commands, it would be a good¬†idea to install body parser from NPM. This module works great for parsing data that has been passed to your application, we will be using it to parse the data that is passed to the POST API that we will be setting up later.\u003C\u002Fp\u003E\n\u003Cp\u003ETo get started with body parser, run the following command in your Terminal window:\u003C\u002Fp\u003E\n\u003Cpre class=\"graf graf--pre graf-after--p\" id=\"b26d\"\u003Enpm install body-parser\u003C\u002Fpre\u003E\n\u003Cp\u003EThen include the following within your main application file:\u003C\u002Fp\u003E\n\u003Cpre class=\"graf graf--pre graf-after--p\" id=\"ec95\"\u003Evar bodyParser = require('body-parser')  \napp.use(bodyParser.json())  \napp.use(bodyParser.urlencoded({ extended: true}))\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cstrong\u003ESetting up the Mongo schema\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EWe are almost done but before we can start sending blog post data we will need to set up our Mongo database table and the schema that will be linked to that table.\u003C\u002Fp\u003E\n\u003Cp\u003ETo do that, you will need to add the following to your main application file:\u003C\u002Fp\u003E\n\u003Cpre class=\"graf graf--pre graf-after--p\" id=\"24c3\"\u003Evar postSchema = new mongoose.Schema({ posttype: String, title: String, date: String, image: String, excerpt: String, body:  String });\u003C\u002Fpre\u003E\n\u003Cpre class=\"graf graf--pre graf-after--pre\" id=\"9285\"\u003Evar Post = mongoose.model('Post', postSchema);\u003C\u002Fpre\u003E\n\u003Cp\u003EI‚Äôve added a few items to the schema here, but basically, you just need to set what your mongo will accept and the type that it should expect. You can \u003Ca href=\"https:\u002F\u002Fmongoosejs.com\u002Fdocs\u002Fguide.html\"\u003Efind out more about Mongoose schemas here\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003ESetting up your API for adding new posts\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EFor this first part, we will be setting up a simplistic¬†API for adding new posts, however, I am aiming to release another blog post soon with more about authenticating APIs with Passport.js. I didn‚Äôt want to fill this one with too much just yet.\u003C\u002Fp\u003E\n\u003Cp\u003EAnyway, to set up your new API you will need to include the following within your application file:\u003C\u002Fp\u003E\n\u003Cpre class=\"graf graf--pre graf-after--p\" id=\"8df2\"\u003Eapp.post('\u002Flaunchpost', (req, res) =\u003E {  \n    var postData = new Post(req.body);  \n    postData.save().then( result =\u003E {  \n        res.redirect('\u002F');  \n    }).catch(err =\u003E {  \n        res.status(400).send(\"Unable to save data\");  \n    });  \n});\u003C\u002Fpre\u003E\n\u003Cp\u003EThis is a pretty simplistic listener that will link to any post request sent to the ‚Äò\u002Flaunchpost‚Äô path on your domain, you can change this to whatever you like as the name doesn‚Äôt really matter.\u003C\u002Fp\u003E\n\u003Cp\u003EWhen someone sends a post request to this path it will grab the data from the body, save it in your configured Mongo table and then redirect the user to the homepage.\u003C\u002Fp\u003E\n\u003Cp\u003EIf you‚Äôd prefer to not have the redirect, you could change that line to the following:\u003C\u002Fp\u003E\n\u003Cpre class=\"graf graf--pre graf-after--p\" id=\"8df2\"\u003Eres.status(200).send(\"Post saved.\");\u003C\u002Fpre\u003E\n\u003Cp\u003EIt will then simply send back a message that says ‚ÄòPost saved‚Äô, you could also expand this to send back the generated post ID.\u003C\u002Fp\u003E\n\u003Cp\u003EYou can query this API with Postman like this:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fuploads\u002Fbp\u002F2019\u002FMarch\u002Fpostman_addpost_2019.jpg\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003ESetting up your API for removing posts\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ESometimes you might want to remove a post that you have previously added so it might also make sense to create an API that will allow you to easily remove posts that you have previously published. You can do that with the following:\u003C\u002Fp\u003E\n\u003Cpre class=\"graf graf--pre graf-after--p\" id=\"8df2\"\u003Eapp.post('\u002Fremovepost', (req, res) =\u003E {  \n    var postData = new Post({_id: req.body.id});  \n    postData.remove().then( result =\u003E {  \n        res.redirect('\u002F');  \n    }).catch(err =\u003E {  \n        res.status(400).send(\"Unable to remove data\");  \n    });  \n});\u003C\u002Fpre\u003E\n\u003Cp\u003EAgain, feel free to change the name of the post or how it responds.\u003C\u002Fp\u003E\n\u003Cp\u003EAnd querying it in Postman will look like this:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fuploads\u002Fbp\u002F2019\u002FMarch\u002Fpostman_removepost_2019.jpg\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003EDisplaying your blog post\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003ENow that you have your APIs ready, you should probably set up a page to do this.\u003C\u002Fp\u003E\n\u003Cp\u003EPersonally, I quite like how the EJS templating engine works, so we will be using that to build the templates and then ultimately show the posts.\u003C\u002Fp\u003E\n\u003Cp\u003EYou can install EJS via your terminal window with the following command:\u003C\u002Fp\u003E\n\u003Cpre class=\"graf graf--pre graf-after--p\" id=\"e345\"\u003Enpm install ejs --save\u003C\u002Fpre\u003E\n\u003Cp\u003EYou will then need to add the following to your application so that Express will use the engine:\u003C\u002Fp\u003E\n\u003Cpre class=\"graf graf--pre graf-after--p\" id=\"62ae\"\u003Eapp.engine('html', require('ejs').renderFile);  \napp.set('view engine', 'html');\u003C\u002Fpre\u003E\n\u003Cp\u003EBy default, EJS will look for template files in a directory named ‚Äòviews‚Äô so you will need to create that and then add an index.html file within that directory.\u003C\u002Fp\u003E\n\u003Cp\u003EThere‚Äôs a lot you can do with EJS in terms of templates, however, for this tutorial we are going to keep things simple, so within this html file we will simply be adding the code to display our posts, feel free to take at look at the EJS documentation to learn more about how to use it.\u003C\u002Fp\u003E\n\u003Cp\u003EBut before then, be sure to include the following code within your index.html file for the displaying of blog posts:\u003C\u002Fp\u003E\n\u003Cpre style=\"margin: 0; line-height: 125%\"\u003E    \u003C% \u003Cspan style=\"color: #0000aa\"\u003Eif\u003C\u002Fspan\u003E(posts){ %\u003E     \u003C% \u003Cspan style=\"color: #0000aa\"\u003Efor\u003C\u002Fspan\u003E(let i = \u003Cspan style=\"color: #009999\"\u003E0\u003C\u002Fspan\u003E; i \u003C posts.length; i++) { %\u003E     \u003Cdiv class=\u003Cspan style=\"color: #aa5500\"\u003E\"card\"\u003C\u002Fspan\u003E\u003E         \u003Cdiv class=\u003Cspan style=\"color: #aa5500\"\u003E\"image\"\u003C\u002Fspan\u003E\u003E         \u003Cimg src=\u003Cspan style=\"color: #aa5500\"\u003E\"\u003C%= posts[i].image %\u003E\"\u003C\u002Fspan\u003E\u003E         \u003C\u002Fdiv\u003E         \u003Cdiv class=\u003Cspan style=\"color: #aa5500\"\u003E\"content\"\u003C\u002Fspan\u003E\u003E         \u003Ca class=\u003Cspan style=\"color: #aa5500\"\u003E\"header\"\u003C\u002Fspan\u003E\u003E\u003C%= posts[i].title %\u003E\u003C\u002Fa\u003E         \u003Cdiv class=\u003Cspan style=\"color: #aa5500\"\u003E\"meta\"\u003C\u002Fspan\u003E\u003E             \u003Cspan class=\u003Cspan style=\"color: #aa5500\"\u003E\"date\"\u003C\u002Fspan\u003E\u003E\u003C%= posts[i].date %\u003E\u003C\u002Fspan\u003E         \u003C\u002Fdiv\u003E         \u003Cdiv class=\u003Cspan style=\"color: #aa5500\"\u003E\"description\"\u003C\u002Fspan\u003E\u003E             \u003C%= posts[i].excerpt %\u003E         \u003C\u002Fdiv\u003E         \u003C\u002Fdiv\u003E         \u003Cdiv class=\u003Cspan style=\"color: #aa5500\"\u003E\"extra content\"\u003C\u002Fspan\u003E\u003E         \u003Ca class=\u003Cspan style=\"color: #aa5500\"\u003E\"ui button primary basic inverted\"\u003C\u002Fspan\u003E href=\u003Cspan style=\"color: #aa5500\"\u003E\"\u002Fpost-single?postID=\u003C%= posts[i]._id %\u003E\"\u003C\u002Fspan\u003E\u003E             Read more         \u003C\u002Fa\u003E         \u003C\u002Fdiv\u003E     \u003C\u002Fdiv\u003E     \u003C% } %\u003E \u003C% } %\u003E \u003C\u002Fpre\u003E\n\u003Cp\u003EFinally, you‚Äôll need to add the route for your homepage like the following:\u003C\u002Fp\u003E\n\u003Cpre style=\"margin: 0; line-height: 125%\"\u003Eapp.get(\u003Cspan style=\"color: #aa5500\"\u003E\"\u002F\"\u003C\u002Fspan\u003E, (req, res) =\u003E {    Post.find({}, (err, posts) =\u003E {       res.render(\u003Cspan style=\"color: #aa5500\"\u003E'index'\u003C\u002Fspan\u003E, { posts: posts})    }); }); \u003C\u002Fpre\u003E\n\u003Cp\u003EAnd for our single page route (you‚Äôll need create a page for this like the homepage):\u003C\u002Fp\u003E\n\u003Cpre style=\"margin: 0; line-height: 125%\"\u003Eapp.get(\u003Cspan style=\"color: #aa5500\"\u003E\"\u002Fpost-single\"\u003C\u002Fspan\u003E, (req, res) =\u003E {     Post.find({ \u003Cspan style=\"color: #aa5500\"\u003E'_id'\u003C\u002Fspan\u003E: req.query.postID }, (err, posts) =\u003E {        res.render(\u003Cspan style=\"color: #aa5500\"\u003E'post-single'\u003C\u002Fspan\u003E, { posts: posts})     }).sort({date: \u003Cspan style=\"color: #aa5500\"\u003E'descending'\u003C\u002Fspan\u003E}); }); \u003C\u002Fpre\u003E\n\u003Ch2\u003EAnd now you are ready to go!\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fmedia.giphy.com\u002Fmedia\u002Fs2qXK8wAvkHTO\u002Fgiphy.gif\" alt=\"\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EYou are ready to get blogging. Of course, you will probably want to authenticate this and you probably don‚Äôt want to be adding post via Postman‚Ä¶ Stay tuned for when I remember to talk about doing that‚Ä¶\u003C\u002Fp\u003E\n"}],error:null,state:{bloglist:[{title:"Using Sentiment Analysis to test user interaction",published:a,description:"Using AWS Comprehend to perform Sentiment Analysis on comments.",tags:"javascript,AWS, AWS Comprehend, Machine Learning",thumbnail:c,header:c,ctime:"2019-05-20",slug:"5ce1f1631c9d440000cbc59c"},{title:"My weekend with AWS DeepRacer",published:a,description:"Here are the results of my weekend playing around with AWS DeepRacer",tags:"javascript,AWS, AWS DeepRacer, Machine Learning",thumbnail:g,header:g,ctime:h,slug:"5ce13a901c9d4400004275bd"},{title:"Adding Service Worker to my site",published:a,description:"Whoops! I forgot to add Service Worker to my site. Probably about time to do that...",tags:"javascript,service worker",thumbnail:i,header:i,ctime:h,slug:"5ce1adde1c9d4400007337c6"},{title:"Adding authentication to our Express blog with Passport.js",published:a,description:"Time to make things secure",tags:"javascript,Node, Express, Passport.js,authentication",thumbnail:j,header:j,ctime:"2019-04-19",slug:"5c7c00ffa1e5fbe51cd94951"},{title:e,published:a,description:f,tags:d,thumbnail:b,header:b,ctime:"2019-04-02",slug:"5c7be6e2a1e5fbe51cd94950"},{title:"Let's begin again...",published:a,description:"Nicholas Griffin V.Something",tags:"Meta",thumbnail:k,header:k,ctime:"2019-04-01",slug:"5c7af91ae6bdacc5ee62ecfe"}]},serverRendered:a}}(true,"https:\u002F\u002Fnicholasgriffin.dev\u002Fuploads\u002Fbp\u002F2019\u002FMarch\u002Fpostman_addpost_2019.jpg","https:\u002F\u002Fcdn.nicholasgriffin.dev\u002Fimages\u002FScreenshot+2019-05-20+at+01.08.17.png","javascript,Express,Node,Mongo","How I built a blog with Node, Express and Mongo","Let's get blogging!","https:\u002F\u002Fcdn.nicholasgriffin.dev\u002Fimages\u002FScreenshot+2019-05-19+at+12.19.03.png","2019-05-19","https:\u002F\u002Fcdn.nicholasgriffin.dev\u002Fimages\u002FScreenshot+2019-05-19+at+20.24.38.png","https:\u002F\u002Fnicholasgriffin.dev\u002Fuploads\u002Fbp\u002F2019\u002FMarch\u002Fusers_js.jpg","https:\u002F\u002Fi.ibb.co\u002Fg6MPvkg\u002FScreenshot-2019-03-02-at-21-45-38.jpg"));</script><script src="/_nuxt/335238b4871730cf9f7d.js" defer></script><script src="/_nuxt/ad3882a62a81c04ccdbd.js" defer></script><script src="/_nuxt/d26db56abffc2e10e685.js" defer></script><script src="/_nuxt/ed5ca3c40fa941f82244.js" defer></script><script src="/_nuxt/8c50d3902d6da8d5999e.js" defer></script>
  </body>
</html>
